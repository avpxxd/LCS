<html>
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,requiresActiveX=true">
    <meta http-equiv="Expires" content="Tue, 12 May 1962 1:00:00 GMT">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Cache-Control" content="no-cache">
    <meta http-equiv="Content-type" content="text/html; charset=ISO-8859-1">
    <meta http-equiv="Content-language" content="en">
    <meta name="refresh" http-equiv="refresh" content="300">



    <title>Live view - AXIS P1354 Network Camera</title>

    <noscript>
      Your browser has JavaScript turned off.<br>For the user interface to work, you must enable JavaScript in your browser and reload/refresh this page.
    </noscript>

<!-- GLOBAL JAVASCRIPTS -->
<script src="/incl/prototypes.js?ver=6.50.5.8" language="javascript" type="text/javascript"></script>
<script src="/incl/zxml.js?ver=6.50.5.8" language="javascript" type="text/javascript"></script>
<script src="/incl/xmlPrototypes.js?ver=6.50.5.8" language="javascript" type="text/javascript"></script>
<script src="/js/sharedjs/AxisConnection.js?ver=6.50.5.8" language="javascript" type="text/javascript"></script>
<script src="/incl/language_incl.js?ver=6.50.5.8" language="javascript" type="text/javascript"></script>
<script src="/js/libs/underscore/underscore.js?ver=6.50.5.8" type="text/javascript" charset="UTF-8"></script>
<script src="/js/libs/jquery/jquery.js?ver=6.50.5.8" type="text/javascript" charset="UTF-8"></script>
<script src="/js/sharedjs/VideoResolutions.js?ver=6.50.5.8" type="text/javascript" charset="UTF-8"></script>
<script src="/js/sharedjs/ParamRequest.js?ver=6.50.5.8" type="text/javascript" charset="UTF-8"></script>
<script src="/js/sharedjs/BaseValidator.js?ver=6.50.5.8" type="text/javascript" charset="UTF-8"></script>
<script src="/js/sharedjs/ErrorService.js?ver=6.50.5.8" type="text/javascript" charset="UTF-8"></script>
<script src="/js/sharedjs/EventUtil.js?ver=6.50.5.8" type="text/javascript" charset="UTF-8"></script>
<script src="/js/sharedjs/CustomEventUtil.js?ver=6.50.5.8" type="text/javascript" charset="UTF-8"></script>
<script src="/incl/general_utils.js?ver=6.50.5.8" language="javascript" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript"><!--

// Replace onload events with DOMContentLoaded, if supported.
if ( document.addEventListener || document.attachEvent)
{
  var onloadDone = false;
  
  function DCLCallback()
  {
    if ( onloadDone )
    {
      return;
    }
    onloadDone = true;

    if ( window.onload )
    {
      var func = window.onload;
      window.onload = null;
      func();
    }
  }

  function OnloadCallback()
  {
    onloadDone = true;
  }   

  if (!window.addEventListener) {
    window.attachEvent("onload", OnloadCallback)
  } else {
    window.addEventListener("load", OnloadCallback);
  }
  if (!document.addEventListener) {
    document.attachEvent("DOMContentLoaded", DCLCallback)
  } else {
    document.addEventListener("DOMContentLoaded", DCLCallback);
  }
}

function launch(url, name) {
  var dualScreenLeft,
      dualScreenTop,
      popW,
      popH,
      leftPos,
      topPos;

  popW = 475;
  popH = 590;

  //checks for dual screen in order to correctly center the popup
  dualScreenLeft = window.screenLeft != undefined ? window.screenLeft : screen.left;
  dualScreenTop = window.screenTop != undefined ? window.screenTop : screen.top;

  leftPos = ((screen.width / 2) - (popW / 2)) + dualScreenLeft;
  var topPos = ((screen.height / 2) - (popH / 2)) + dualScreenTop;

  self.name = "opener";
  remote = document.open(url, name || 'helpWin', "resizable,scrollbars,status,width=" + popW + ",height="+popH+",left="+leftPos+",top="+topPos+"");

  //Fix for IE6 to solve problem with video stopping when opening help
  try {
    if ((typeof(useAMC) != "undefined")&&(useAMC == "yes") &&(navigator.appVersion.indexOf("MSIE 6") != -1) && (typeof(stopStartStream) == "function") && (typeof(imagepath) == "string"))
      stopStartStream(imagepath);
  } catch (e) {}
}

function openPopUp(thePage, theName, theWidth, theHeight)
{
  theWidth = Number( theWidth ) + 10;
  theHeight = Number( theHeight ) + 20;

  var someFeatures = 'scrollbars=yes,toolbar=0,location=no,directories=0,status=0,menubar=0,resizable=1,width=' + theWidth + ',height=' + theHeight;
  var aPopUpWin = document.open(thePage, theName, someFeatures);

  if (navigator.appName == "Netscape" && aPopUpWin != null) {
    aPopUpWin.focus();
  }
}

function showStatus(msg)
{
  window.status = msg
  return true
}
// -->
</script><script language="JavaScript">
<!--

function CSS ()
{
  if ((navigator.appVersion.indexOf("Mac") != -1) && (navigator.appName.indexOf("Netscape") != -1)) {
    document.write('<link rel="stylesheet" href="/css/mac_ns.css?version=143" type="text/css" />');

  } else if ((navigator.appVersion.indexOf("Mac") != -1) && (navigator.appName.indexOf("Microsoft Internet Explorer") != -1)) {
    document.write('<link rel="stylesheet" href="/css/mac_ie.css?version=143" type="text/css" />');

  } else if ((navigator.appVersion.indexOf("Win") != -1) && (navigator.appName.indexOf("Netscape") != -1)) {
    document.write('<link rel="stylesheet" href="/css/win_ns.css?version=143" type="text/css" />');

  } else if ((navigator.appVersion.indexOf("Win") != -1) && (navigator.appName.indexOf("Microsoft Internet Explorer") != -1)) {
    document.write('<link rel="stylesheet" href="/css/win_ie.css?version=143" type="text/css" />');

  } else if (navigator.appName.indexOf("Netscape") != -1) {
    // Unix or other system
    document.write('<link rel="stylesheet" href="/css/win_ns.css?version=143" type="text/css" />');
  } else {         
    document.write('<link rel="stylesheet" href="/css/other.css?version=143" type="text/css" />');
  }

  // Wrapper for old browsers which can't handle getElementById
  if(!document.getElementById) {
     document.getElementById = function(element)
     {
       return eval("document.all." + element);
     }
  }
}
// -->
</script>
<script language="JavaScript" type="text/javascript"><!--
CSS ();
// -->
</script><link rel="stylesheet" href="/css/win_ns.css?version=143" type="text/css">

<script language="JavaScript" type="text/javascript">
<!--
function SubmitForm()
{
  document.WizardForm.submit();
}
// -->
</script>

<!-- END GLOBAL JAVASCRIPTS -->
<style type="text/css">
  #streamPlaceholder {
    position: relative;
    width: 480px;
    height: 270px;
    background-color: white;
    border: 1px solid #ccc;
  }
  #streamPlaceholder > .hint {
    position: absolute;
    height: 80px;
    top: 50%;
    margin-top: -40px;
    left: 0;
    right: 0;
    z-index: 2;
    text-align: center;
  }
  #streamPlaceholder > .hint > * {
    padding: 4px;
    margin: 0;
  }
  #streamPlaceholder > .hint > .header {
    font-size: 14px;
    font-weight: bold;
    margin-top: 10px;
    margin-bottom: 6px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }
</style>



<script src="/js/sharedjs/CustomEventUtil.js?ver=6.50.5.8"></script>

<script language="JavaScript">
<!--
var langObjView = new Language("platoon", "view");

var browser = "Netscape";
if (isBrowserIE()) {
  browser = "IE";
}

// Various functions that may be useful

/**
 * Get the image max FPS.
 * @param  {number} imagenbr The image source number
 * @return {number}          The max FPS
 */
function getImageMaxFPS (imagenbr) {
    imagenbr = 0;
  var maxFrameRates = [];
  maxFrameRates[1] = 30;
  maxFrameRates[0] = Math.floor((30000+60)/1000);


  return _.isUndefined(maxFrameRates[imagenbr]) ? maxFrameRates[0] :  maxFrameRates[imagenbr];
}

/**
 * Partially apply a given set of parameters
 * @param  {function<T>} The function to partially apply the set of parameters on
 * @param {...object} The parameters to partially apply (e.g. var add10 = partial(add_func, 10) on function add(a, b) -> add10(20) would return 30)
 * @return {function<T>} A function where the specified set of parameters are already applied
 */
function partial() {
  var __slice = Array.prototype.slice,
      initialArgs = __slice.call(arguments, 1),
      func = arguments[0];

  return function() {
    return func.apply(func, initialArgs.concat(__slice.call(arguments)));
  }
}

/**
 * Create a function that will invoke a series of functions sequentially
 * @param  {...function<T>} The functions to invoke in a sequence
 * @return {function} Function that will invoke a series of functions sequentially
 */
function sequence() {
  var args = Array.prototype.slice.call(arguments);

  return function() {
    var func;

    for (var i = 0, length = args.length; i < length; i++) {
      try {
        args[i]();
      } catch (e) {
        console.log(e);
      }
    }
  }
}

// Functions to include to handle selection of stream profiles

var globProfileBase = "root_StreamProfile_S";

function profileSelectUrlpars(listform,editform)
{
  group = editform.streamprofile.options[editform.streamprofile.selectedIndex].value;
  if (group == "none") {
    return "";
  }
  name = globProfileBase + group + "_Parameters";
  return listform[name].value;
}

function profileParseOption(optionString,option)
{
  var res = "";
  option += "=";
  var start = optionString.indexOf(option);
  if (start >= 0) {
    start += option.length;
     var end = optionString.indexOf("&", start);
    if (end >= 0)
      res = optionString.substring(start, end);
    else
      res = optionString.substring(start);
  }
  return res;
}

function profileCurrentMax(listform)
{
  var grpMax = 0;
  for (i = 0; i < listform.elements.length; i++) {
    var par = listform.elements[i].name;
    pos1 = globProfileBase.length;
    pos2 = par.indexOf('_', globProfileBase.length);
    var grp = 1 * (par.substring(pos1, pos2));
    if (grp > grpMax) {
      grpMax = grp;
    }
  }
  return grpMax;
}

function profileOptionsWrite(listform,selopt)
{
  var elemName, name, cls, optionValue;

  var grpMax = profileCurrentMax(listform);
  for (var grp = 0; grp <= grpMax; grp++) {
    elemName = globProfileBase + grp + "_Name";
    if (document.getElementsByName(elemName).length > 0) {
      name = listform[elemName].value;

      cls = "";
      optionValue = grp;
      if (name == selopt) {
        document.write("<option value=\"" + optionValue + "\" selected=\"selected\""+cls+">" + name + "</option>");
      } else {
        document.write("<option value=\"" + optionValue + "\""+cls+">" + name + "</option>");
      }
    }
  }
}



function getProfileOptionsArray(listform,selopt)
{
  var elemName, name, optionValue, sel;
  var retArray = new Array();

  var grpMax = profileCurrentMax(listform);
  for (var grp = 0; grp <= grpMax; grp++)
  {
    elemName = globProfileBase + grp + "_Name";
    if (document.getElementsByName(elemName).length > 0) {
      name = listform[elemName].value;
      optionValue = grp;
      
      if(selopt == name)
        sel = true;
      else
        sel = false;
      retArray.push( {val: optionValue, text: name, selected: sel} );
    }
  }
  
  return retArray;
}

function profileSelectWrite(listform,selopt)
{
  var grpMax = profileCurrentMax(listform);

  /* Write start */
  document.write("<select name='streamprofile' size='1'>");
  document.write("<option selected value='none'>-----------</option>");

  profileOptionsWrite(listform,selopt);

  /* Write end */
  document.write('</select>');
}

function getProfileGrp(listform,theProfile)
{
  var grpMax = profileCurrentMax(listform);
  var grp = "Profile group not found"
  for (i=0; i<=grpMax; i++) {
    elemName = globProfileBase + i + "_Name";
    if (document.getElementsByName(elemName).length > 0) {
      name = listform[elemName].value;
      if (name == theProfile)
        var grp = i
    }
  }
  return grp;
}

function outputBox(title, elArr, spacerAfter, spacerBefore, fillWhole, otherOutputTr, id)
{
  var blankImage5x5 = document.createElement("img");
  blankImage5x5.src = "/pics/blank.gif";
  blankImage5x5.style.width = "5px";
  blankImage5x5.style.height = "5px";
  blankImage5x5.style.border = "0";

  var blankImage4x5 = document.createElement("img");
  blankImage4x5.src = "/pics/blank.gif";
  blankImage4x5.style.width = "4px";
  blankImage4x5.style.height = "5px";
  blankImage4x5.style.border = "0";

  var blankImage1x5 = document.createElement("img");
  blankImage1x5.src = "/pics/blank.gif";
  blankImage1x5.style.width = "1px";
  blankImage1x5.style.height = "5px";
  blankImage1x5.style.border = "0";

  var mainCell = document.createElement("td");

  if (id)
    mainCell.id = id;

  if(fillWhole == true)
    mainCell.style.width = "100%";

  var tbl1 = document.createElement("table");
  tbl1.style.width = "100%";
  tbl1.style.height = "46px";
  tbl1.cellPadding = "0";
  tbl1.cellSpacing = "0";
  tbl1.style.border = "0";

  var tbl1Tbody = document.createElement("tbody");

  var tbl1Row1 = document.createElement("tr");
  tbl1Row1.className="top-mainborder";

  var tbl1Row1Cell1 = document.createElement("td");
  tbl1Row1Cell1.colSpan = 2;
  tbl1Row1Cell1.style.width = "5px";
  tbl1Row1Cell1.style.backgroundImage = "url(\"/pics/gray_corner_lt_5x50px.gif\")";
  tbl1Row1Cell1.appendChild( blankImage5x5.cloneNode(false) );

  var tbl1Row1Cell2 = document.createElement("td");
  tbl1Row1Cell2.vAlign = "top";
  tbl1Row1Cell2.align = "center";
  tbl1Row1Cell2.style.width = "100%";
  tbl1Row1Cell2.style.height = "5px";
  tbl1Row1Cell2.className = "funcText";
  tbl1Row1Cell2.style.whiteSpace = "nowrap";
  tbl1Row1Cell2.style.backgroundImage = "url(\"/pics/gray_t_5x50px.gif\")";
  tbl1Row1Cell2.innerHTML = title;

  var tbl1Row1Cell3 = document.createElement("td");
  tbl1Row1Cell3.colSpan = 2;
  tbl1Row1Cell3.style.width = "5px";
  tbl1Row1Cell3.style.backgroundImage = "url(\"/pics/gray_corner_rt_5x50px.gif\")";
  tbl1Row1Cell3.appendChild( blankImage5x5.cloneNode(false) );

  var tbl1Row2 = document.createElement("tr");

  var tbl1Row2Cell1 = document.createElement("td");
  tbl1Row2Cell1.style.width = "1px";
  tbl1Row2Cell1.className = "lineBg";
  tbl1Row2Cell1.appendChild( blankImage1x5.cloneNode(false) );

  var tbl1Row2Cell2 = document.createElement("td");
  tbl1Row2Cell2.style.width = "4px";
  tbl1Row2Cell2.appendChild( blankImage4x5.cloneNode(false) );

  var tbl1Row2Cell3 = document.createElement("td");
  tbl1Row2Cell3.vAlign = "middle";
  tbl1Row2Cell3.align = "center";
  tbl1Row2Cell3.style.width = "100%";

  var tbl2 = document.createElement("table");
  tbl2.cellPadding = "0";
  tbl2.cellSpacing = "0";
  tbl2.style.border = "0";

  var tbl2Tbody = document.createElement("tbody");

  var tbl2Row1 = document.createElement("tr");

  var retEl;
  for(var i=0; i < elArr.length; i++)
  {
    retEl = null;

    if(elArr[i].type == "button")
    {
      retEl = getButtonForBox(elArr[i].pic, elArr[i].alt, elArr[i].url, elArr[i].name, elArr[i].pressed, elArr[i].onClick, elArr[i].width, elArr[i].height, elArr[i].id);
    }
    else if(elArr[i].type == "select")
    {
      retEl = getSelectForBox(elArr[i].name, elArr[i].onChange, elArr[i].disabled, elArr[i].optionArr, elArr[i].extraOptionArr, elArr[i].extraCode);
    }
    else if(elArr[i].type == "toggle")
    {
      retEl = getToggleForBox(
        elArr[i].nameActive,
        elArr[i].nameInactive,
        elArr[i].picActivePressed,
        elArr[i].picActive,
        elArr[i].picInactivePressed,
        elArr[i].picInactive,
        elArr[i].urlActive,
        elArr[i].urlInactive,
        elArr[i].initStatusActive,
        elArr[i].altActive,
        elArr[i].altInactive,
        elArr[i].displaySingleImage);
    }
    else if(elArr[i].type == "slider")
    {
      retEl = getSliderForBox(elArr[i].name, elArr[i].val, elArr[i].images);
    }
    else if(elArr[i].type == "inputOutput")
    {
      retEl = getInputOutputForBox(elArr[i].inNbr, elArr[i].outNbr);
    }
    else if(elArr[i].type == "trContainer")
    {
      retEl = getColumns(elArr[i].elements);
    }
    else if(elArr[i].type == "empty")
    {
      retEl = document.createElement("td");
      retEl.vAlign = "middle";
      retEl.align = "left";
      retEl.id = elArr[i].id;
      retEl.innerHTML = "<br>";
    }

    if(retEl != null)
    {
      if( retEl instanceof Array)
      {
        retEl.forEach(function(td)
        {
          tbl2Row1.appendChild(td);
        });
      }
      else
        tbl2Row1.appendChild( retEl );
    }
  }

  var tbl1Row2Cell4 = document.createElement("td");
  tbl1Row2Cell4.style.width = "4px";
  tbl1Row2Cell4.appendChild( blankImage4x5.cloneNode(false) );

  var tbl1Row2Cell5 = document.createElement("td");
  tbl1Row2Cell5.style.width = "1px";
  tbl1Row2Cell5.className = "lineBg";
  tbl1Row2Cell5.appendChild( blankImage1x5.cloneNode(false) );

  var tbl1Row3 = document.createElement("tr");
  tbl1Row3.className="bottom-mainborder";

  var tbl1Row3Cell1 = document.createElement("td");
  tbl1Row3Cell1.colSpan = 2;
  tbl1Row3Cell1.style.width = "5px";
  tbl1Row3Cell1.style.backgroundImage = "url(\"/pics/line_corner_lb_5x5px.gif\")";
  tbl1Row3Cell1.appendChild( blankImage5x5.cloneNode(false) );

  var tbl1Row3Cell2 = document.createElement("td");
  tbl1Row3Cell2.style.width = "100%";
  tbl1Row3Cell2.style.height = "5px";
  tbl1Row3Cell2.style.backgroundImage = "url(\"/pics/line_b_100x5px.gif\")";
  tbl1Row3Cell2.appendChild( blankImage1x5.cloneNode(false) );

  var tbl1Row3Cell3 = document.createElement("td");
  tbl1Row3Cell3.colSpan = 2;
  tbl1Row3Cell3.style.width = "5px";
  tbl1Row3Cell3.style.height = "5px";
  tbl1Row3Cell3.style.backgroundImage = "url(\"/pics/line_corner_rb_5x5px.gif\")";
  tbl1Row3Cell3.appendChild( blankImage5x5.cloneNode(false) );

  var spacerCell = document.createElement("td");
  spacerCell.style.width = "5px";
  spacerCell.appendChild( blankImage5x5.cloneNode(false) );


  //Append everything created
  tbl1Row1.appendChild( tbl1Row1Cell1 );
  tbl1Row1.appendChild( tbl1Row1Cell2 );
  tbl1Row1.appendChild( tbl1Row1Cell3 );

  tbl1Row2.appendChild( tbl1Row2Cell1 );
  tbl1Row2.appendChild( tbl1Row2Cell2 );

  tbl2Tbody.appendChild( tbl2Row1 );
  tbl2.appendChild( tbl2Tbody );
  tbl1Row2Cell3.appendChild( tbl2 );

  tbl1Row2.appendChild( tbl1Row2Cell3 );
  tbl1Row2.appendChild( tbl1Row2Cell4 );
  tbl1Row2.appendChild( tbl1Row2Cell5 );

  tbl1Row3.appendChild( tbl1Row3Cell1 );
  tbl1Row3.appendChild( tbl1Row3Cell2 );
  tbl1Row3.appendChild( tbl1Row3Cell3 );

  tbl1Tbody.appendChild( tbl1Row1 );
  tbl1Tbody.appendChild( tbl1Row2 );
  tbl1Tbody.appendChild( tbl1Row3 );

  tbl1.appendChild( tbl1Tbody );
  mainCell.appendChild( tbl1 );

  var appenderTr = "appendableTr";
  if(otherOutputTr != null)
    appenderTr = otherOutputTr;

  if(spacerBefore)
    document.getElementById(appenderTr).appendChild( spacerCell );

  document.getElementById(appenderTr).appendChild( mainCell );

  if(spacerAfter)
    document.getElementById(appenderTr).appendChild( spacerCell );
}

function getButtonForBox(pic, alt, url, name, pressed, onClick, width, height, id)
{
  var td = document.createElement("td");
  td.vAlign = "middle";
  td.align = "left";

  var a = document.createElement("a");
  var img = document.createElement("img");

  if(url)
  {
    a.href = url;

    if(onClick)
      a.onclick = new Function(onClick);

    if(name)
    {
      a.id = name+"_link";
      a.onmousedown = function() { movepic( name, pressed) };
      a.onmouseup = function() { movepic( name, pic) };
      img.name = name;
    }
    else
      a.target = "_self";
  }

  img.src = pic;
  if(width)
    img.style.width = width;
  else
    img.style.width = "27px";

  if(height)
    img.style.height = height;
  else
    img.style.height = "27px";

  img.border = "0";

  if(id)
    img.id = id;

  if(alt)
  {
    img.alt = alt;
    img.title = alt;
  }

  if(a.href)
  {
    a.appendChild( img );
    td.appendChild( a );
  }
  else
    td.appendChild( img );

  return td;
}

function getSelectForBox(name, onChange, disabled, optionArr, extraOptionArr, extraCode)
{
  var td = document.createElement("td");
  td.vAlign = "middle";
  td.align = "left";

  var select = document.createElement("select");
  select.name = name;
  select.id = name;
  if( select.addEventListener )
    select.addEventListener('change', onChange, false);
  else
    select.attachEvent('onchange', onChange);

  if(disabled)
    select.disabled = true;

  langObjView.addOptionsToList(select, optionArr);

  if(extraOptionArr)
    langObjView.addOptionsToList(select, extraOptionArr);

  td.appendChild( select );

  if(extraCode)
  {
    if( typeof( extraCode ) != "string" )
    {
      td.appendChild( extraCode );
    }
    else
    {
      td.innerHTML += extraCode;
    }
  }

  return td;
}

function getToggleForBox(nameActive, nameInactive, picActivePressed, picActive, picInactivePressed, picInactive, urlActive, urlInactive, initStatusActive, altActive, altInactive, displaySingleImage)
{
  var td = document.createElement("td");
  td.vAlign = "middle";
  td.align = "left";

  var a = document.createElement("a");
  a.id = nameActive+"_link";
  a.href = urlActive;
  a.onmousedown = function() { movepic( nameActive, picActivePressed); movepic( nameInactive, picInactive); };

  var img = document.createElement("img");
  img.name = nameActive;
  img.src = (initStatusActive ? picActivePressed : picActive);
  img.width = "27";
  img.height = "27";
  img.border = "0";
  img.alt = altActive;
  img.title = altActive;

  a.appendChild( img );

  var td1 = document.createElement("td");
  td1.vAlign = "middle";
  td1.align = "left";

  var a1 = document.createElement("a");
  a1.id = nameInactive+"_link";
  a1.href = urlInactive;
  a1.onmousedown = function() { movepic( nameActive, picActive); movepic( nameInactive, picInactivePressed); };

  img1 = document.createElement("img");
  img1.name = nameInactive;
  img1.src = (initStatusActive ? picInactivePressed : picInactive);
  img1.width = "27";
  img1.height = "27";
  img1.border = "0";
  img1.alt = altInactive;
  img1.title = altInactive;

  a1.appendChild( img1 );

  if(displaySingleImage)
  {
    a.setAttribute("onclick","javascript:toggleImage(this,true);");
    a1.setAttribute("onclick","javascript:toggleImage(this,false);");

    if(initStatusActive)
    {
      a.style.display = "none";
    }
    else
    {
      a1.style.display ="none";
    }

    td.appendChild(a);
    td.appendChild(a1);

    return td;
  }
  else
  {
    td.appendChild( a );
    td1 = document.createElement("td");
    td1.appendChild( a1 );

    var retArr = new Array();
    retArr.push( td );
    retArr.push( td1 );
    return retArr;
  }
}

function toggleImage(element, isActiveImage) {
  var parent = element.parentNode;

  if(isActiveImage)
  {
    parent.childNodes[0].style.display = "none";
    parent.childNodes[1].style.display = "";
  }
  else
  {
    parent.childNodes[0].style.display = "";
    parent.childNodes[1].style.display = "none";
  }
}

function getTimeStamp() {
  return "&timestamp=" + new Date().getTime();
};

function getColumns(elements) {
  var columns = [];
  elements.forEach(function(tdElements)
  {
    var td = document.createElement("td");
    td.vAlign = "middle";
    td.align = "left";

    tdElements.forEach(function(element) {
      td.appendChild(element);
    });

    columns.push(td);
  });

  return columns;
}

function switchElements(elementsToShowId, elementsToHideId) {
  setDisplay(elementsToShowId, "");
  setDisplay(elementsToHideId, "none");

  function setDisplay(elementIds, display) {
    if(elementIds instanceof Array) {
      elementIds.forEach(function(elementId)
      {
        document.getElementById(elementId).style.display = display;
      });
    }
    else {
      document.getElementById(elementIds).style.display = display;
    }
  }
}

function getSliderForBox(name, val, images)
{
  var td = document.createElement("td");
  td.vAlign = "middle";
  td.style.whiteSpace = "nowrap";

  var sliderImg;
  for(var j=0; j < images.length; j++)
  {
    sliderImg = document.createElement("img");
    sliderImg.id = images[j].id;
    sliderImg.src = images[j].src;
    sliderImg.style.width = images[j].width;
    sliderImg.style.height = images[j].height;
    sliderImg.style.display = "inline";

    td.appendChild( sliderImg );
  }

  td1 = document.createElement("td");

  var inp = document.createElement("input");
  inp.type = "hidden";
  inp.name = name;
  inp.id = name;
  inp.size = 4;
  inp.value = val;

  td1.appendChild( inp );

  var retArr = new Array();
  retArr.push( td );
  retArr.push( td1 );

  return retArr;
}

function getInputOutputForBox(inNbr, outNbr)
{
  var ioTable = document.createElement("table");
  ioTable.cellPadding = "0";
  ioTable.cellSpacing = "0";
  ioTable.style.border = "0";
  ioTable.style.width = "768px";

  var ioTableTbody = document.createElement("tbody");

  var ioTableRow1 = document.createElement("tr");

  var ioTableRow1Cell1 = document.createElement("td");
  ioTableRow1Cell1.vAlign = "middle";
  ioTableRow1Cell1.align = "left";
  ioTableRow1Cell1.style.width = "10%";
  ioTableRow1Cell1.style.whiteSpace = "nowrap";
  ioTableRow1Cell1.innerHTML = langObjView.getText("inpPortsTxt");

  ioTableRow1.appendChild( ioTableRow1Cell1 );

  var ioTableRow1Cell2X = document.createElement("td");
  ioTableRow1Cell2X.vAlign = "middle";
  ioTableRow1Cell2X.align = "center";
  ioTableRow1Cell2X.style.width = "10%";

  var inLoopMainTd;
  var inLoopTbl;
  var inLoopTbody;
  var inLoopTr1;
  var inLoopTr1Td;
  var inLoopTr1TdSpan;
  var inLoopTr2;
  var inLoopTr2Td;
  var inLoopTr2TdSpan;
  for(var i=0; i < inNbr; i++)
  {
    inLoopMainTd = ioTableRow1Cell2X.cloneNode(false);

    inLoopTbl = document.createElement("table");
    inLoopTbl.style.border = "0";
    inLoopTbody = document.createElement("tbody");

    inLoopTr1 = document.createElement("tr");
    inLoopTr1Td = document.createElement("td");
    inLoopTr1Td.align = "center";
    inLoopTr1TdSpan = document.createElement("span");
    inLoopTr1TdSpan.id = "inname"+i;
    inLoopTr2 = document.createElement("tr");
    inLoopTr2Td = document.createElement("td");
    inLoopTr2Td.align = "center";
    inLoopTr2Td.vAlign = "middle";
    inLoopTr2TdSpan = document.createElement("span");
    inLoopTr2TdSpan.id = "instat"+i;

    inLoopTr1Td.appendChild( inLoopTr1TdSpan );
    inLoopTr1.appendChild( inLoopTr1Td );

    inLoopTr2Td.appendChild( inLoopTr2TdSpan );
    inLoopTr2.appendChild( inLoopTr2Td );

    inLoopTbody.appendChild( inLoopTr1 );
    inLoopTbody.appendChild( inLoopTr2 );

    inLoopTbl.appendChild( inLoopTbody );
    inLoopMainTd.appendChild( inLoopTbl );

    ioTableRow1.appendChild( inLoopMainTd );
  }

  var ioTableRow2 = document.createElement("tr");

  var ioTableRow2Cell1 = ioTableRow1Cell1.cloneNode(false);
  ioTableRow2Cell1.innerHTML = langObjView.getText("outPortsTxt");

  ioTableRow2.appendChild( ioTableRow2Cell1 );

  var ioTableRow2Cell2X = ioTableRow1Cell2X.cloneNode(false);

  var outLoopMainTd;
  var outLoopTbl;
  var outLoopTbody;
  var outLoopTr1;
  var outLoopTr1Td;
  var outLoopTr1TdSpan;
  var outLoopTr2;
  var outLoopTr2Td;
  var outLoopTr2TdSpan1;
  var outLoopTr2TdSpan2;
  var outLoopTr2TdSpan3;
  for(var i=0; i < outNbr; i++)
  {
    outLoopMainTd = ioTableRow2Cell2X.cloneNode(false);

    outLoopTbl = document.createElement("table");
    outLoopTbl.style.border = "0";
    outLoopTbody = document.createElement("tbody");

    outLoopTr1 = document.createElement("tr");
    outLoopTr1Td = document.createElement("td");
    outLoopTr1Td.align = "center";
    outLoopTr1TdSpan = document.createElement("span");
    outLoopTr1TdSpan.id = "outname"+i;
    outLoopTr2 = document.createElement("tr");
    outLoopTr2Td = document.createElement("td");
    outLoopTr2Td.align = "center";
    outLoopTr2Td.vAlign = "middle";
    outLoopTr2TdSpan = document.createElement("span");
    outLoopTr2TdSpan1.id = "outon"+i;
    outLoopTr2TdSpan2 = document.createElement("span");
    outLoopTr2TdSpan2.id = "outpulse"+i;
    outLoopTr2TdSpan3 = document.createElement("span");
    outLoopTr2TdSpan3.id = "outoff"+i;


    outLoopTr1Td.appendChild( outLoopTr1TdSpan );
    outLoopTr1.appendChild( outLoopTr1Td );

    outLoopTr2Td.appendChild( outLoopTr2TdSpan1 );
    outLoopTr2Td.appendChild( outLoopTr2TdSpan2 );
    outLoopTr2Td.appendChild( outLoopTr2TdSpan3 );
    outLoopTr2.appendChild( outLoopTr2Td );

    outLoopTbody.appendChild( outLoopTr1 );
    outLoopTbody.appendChild( outLoopTr2 );

    outLoopTbl.appendChild( outLoopTbody );
    outLoopMainTd.appendChild( outLoopTbl );

    ioTableRow2.appendChild( outLoopMainTd );
  }

  //appendEverything created for input/output
  ioTableTbody.appendChild( ioTableRow1 );
  ioTableTbody.appendChild( ioTableRow2 );
  ioTable.appendChild( ioTableTbody );

  var td = document.createElement("td");
  td.appendChild( ioTable );

  return td;
}


// Draw the scale buttons
function drawScaleButtons()
{
  var currentResolution = 0
  var width = 0
  var height = 0
  var imagepath = decodeEncodingJavascript('/mjpg/video.mjpg');
  var resStart = imagepath.indexOf("resolution=")
  if (resStart != -1) {
    var resStop = imagepath.indexOf("&", resStart)
    if (resStop == -1) resStop = imagepath.length
    currentResolution = imagepath.substring(resStart + 11, resStop);
    width = parseInt(currentResolution.substring(0, currentResolution.indexOf('x')), 10);
    height = parseInt(currentResolution.slice((currentResolution.indexOf('x') + 1)), 10);
  } else {
    width = "1024";
    height = "768";
    currentResolution = width + 'x' + height;
  }

  if (currentResolution.indexOf("x") != -1) {
    var currentWidth  = parseInt(currentResolution.substring(0, currentResolution.indexOf("x")), 10),
        currentHeight = parseInt(currentResolution.slice((currentResolution.indexOf('x') + 1)), 10);
    if (!((currentWidth <= 800 && currentHeight <= 600) || (currentWidth <= 600 && currentHeight <= 800)))
    {
      scaleArr = new Array();
      scaleArr.push( {type: "button", pic: "/pics/button_downsize_gray_27x27px.gif", alt: langObjView.getText("adjToBrSizeTxt"), url: "JavaScript:dynamicResize(true)", id: "adjustSize"} );
      scaleArr.push( {type: "button", pic: "/pics/button_x1_gray_27x27px.gif", alt: langObjView.getText("fuImTxt"), url: "JavaScript:dynamicResize(false)", id: "fullSize"} );
      outputBox(langObjView.getText("viewSizeTxt"), scaleArr, true);
    }
  }
}




  function newVideoFormat()
  {
    newVideoFormatCam('1');
  }

  var supportedResolutionsObj = null;

  function getAllSupportedResolutions() {
    supportedResolutionsObj = new Object();
    var res  = decodeEncodingJavascript('1280x960&#44;1024x768&#44;800x600&#44;640x480&#44;480x360&#44;320x240&#44;240x180&#44;160x120&#44;1280x720&#44;800x450&#44;640x360&#44;480x270&#44;320x180&#44;160x90&#44;1280x800&#44;176x144');
    supportedResolutionsObj[1] = res.split(',');
}

function getSupportedResolution(name) {
  if (supportedResolutionsObj == null)
    getAllSupportedResolutions();

  if (supportedResolutionsObj[name]) {
    return supportedResolutionsObj[name];
  }
  return null;
}

  function newVideoFormatCam(cam)
  {
    var url = "";
    var options = "";
    var selvalue = "#UNSELECTABLE#";
    var oVideoFormat = document.WizardForm.videoFormat;
    if( oVideoFormat && oVideoFormat.selectedIndex >= 0 )
    {
      selvalue = oVideoFormat[oVideoFormat.selectedIndex].value;
    }

    if( selvalue == "#UNSELECTABLE#")
    {
      return;
    }


    var selvalueLC = selvalue.toLowerCase();
    var hasMultipleSources = false;
    if (selvalueLC == "mjpeg")
    {
      url = '/mjpg/video.mjpg' + (hasMultipleSources ? '?camera='+cam : '');
    }
    else if (selvalueLC == "mpeg4")
    {
      url = '/axis-media/media.amp?videocodec=mpeg4' + (hasMultipleSources ? '&camera=' + cam : '');
    }
    else if (selvalueLC == "h264" ||
        selvalueLC == "hdtv")
    {
      url = '/axis-media/media.amp?videocodec=h264' + (hasMultipleSources ? '&camera=' + cam : '');
      if (selvalueLC == "hdtv")
      {
        var supportedResolutions = getSupportedResolution(cam);
        if (supportedResolutions.indexOf( "1920x1080" ) >= 0)
          url += '&resolution=1920x1080' +
                 '&videoformat-hdtv';
        else if(supportedResolutions.indexOf( "1280x720" ) >= 0)
          url += '&resolution=1280x720' +
                 '&videoformat-hdtv';
      }
    }
    else
    {
      var val = document.profileForm["root_StreamProfile_S" + selvalue + "_Name"].value;
      if (val) {
        options = "&streamprofile=" + val;
        val = profileParseOption(document.profileForm["root_StreamProfile_S" + selvalue + "_Parameters"].value,"audio");
        if (val == "1") {
          options += "&audio=yes";
        } else if (val == "0") {
          options += "&audio=no";
        }
      }

      var enc = profileParseOption(document.profileForm["root_StreamProfile_S" + selvalue + "_Parameters"].value,"videocodec");
      if ( enc === "" )
        enc = "mjpeg";
      if (enc == "jpeg" ||
          enc == "mjpeg") {
        url = '/mjpg/video.mjpg' + (hasMultipleSources ? '?camera='+cam : '');
      }  else if (enc == "mpeg4") {
        url = '/axis-media/media.amp?videocodec=mpeg4' + (hasMultipleSources ? '&camera=' + cam : '');
      }  else if (enc == "h264" ||
          enc == "hdtv") {
        url = '/axis-media/media.amp?videocodec=h264' + (hasMultipleSources ? '&camera=' + cam : '');
        if (selvalueLC == "hdtv")
        {
          var supportedResolutions = getSupportedResolution(cam);
          if (supportedResolutions.indexOf( "1920x1080" ) >= 0)
            url += '&resolution=1920x1080' +
                   '&videoformat-hdtv';
          else if (supportedResolutions.indexOf( "1280x720" ) >= 0)
            url += '&resolution=1280x720' +
                   '&videoformat-hdtv';
        }
      }
    }
    changeView(url, cam, '', '1', options);
  }


  // Draw the format drop down
  function writeFormatOptions()
  {
    var fmt = "mjpeg+";
    var cam = '1';
    var normOpArr = new Array();
    normOpArr.push( {val: "MJPEG", text: "Motion JPEG", selected: (fmt === "mjpeg+")} );
    normOpArr.push( {val: "H264", text: "H.264", selected: (fmt === "h264+")} );
    var supportedResolutions = getSupportedResolution(cam);
    if( supportedResolutions.indexOf( "1280x720" ) >= 0 ||
        supportedResolutions.indexOf( "1920x1080" ) >= 0 )
      normOpArr.push( {val: "hdtv", text: langObjView.getText("hdtvSelTxt"), selected: (fmt === "hdtv+")} );


    var profileform = document.profileForm;
    var extraOpArr = getProfileOptionsArray(profileform,fmt);

    var elArr = new Array();
    elArr.push( {type: "select", name: "videoFormat", onChange: newVideoFormat, optionArr: normOpArr, extraOptionArr: extraOpArr, disabled: false } );

    outputBox(langObjView.getText("strProTxt"), elArr, true);

 }// $external = no// $seq != yes// $root_Layout_ShowVideoFormatDropDown = yes





  var ioPortValues = AxisConnectionFactory.createAjaxConnection();
  var ioPortDirections = AxisConnectionFactory.createAjaxConnection();

  function requestIOPortStates()
  {
    var check = "/axis-cgi/io/port.cgi?check=";
    var checkdirection = "/axis-cgi/io/port.cgi?checkdirection=";
    var numberOfPorts = (1+1);

    for (var i=1; i<=numberOfPorts; i++)
    {
      check += i;
      checkdirection += i;
      if (i != numberOfPorts) {
        check += ",";
        checkdirection += ",";
      }
    }

    AxisConnectionFactory.sendAsync(["GET", check + "&rand=" + Math.random()], null, drawOutputButtons, ioPortValues);
    AxisConnectionFactory.sendAsync(["GET", checkdirection + "&rand=" + Math.random()], null, drawOutputButtons, ioPortDirections);
  }

  // Draw the output buttons
  function drawOutputButtons()
  {
    var form = document.outputsForm;

    if(ioPortValues.getReadyState() == 4 && ioPortDirections.getReadyState() == 4)
    {
      var txt_values = ioPortValues.getResponseText();
      var txt_directions = ioPortDirections.getResponseText();
      var OutputName = "";
      var unit = "";
      var value = 0;
      var displayValue = 0.0;
      var IO_Status = new Array(2);
      var outputs = "";
      var inputs = "";

      for (var i=0; i<=(1+1); i++)
      {
        if (txt_directions.indexOf('port'+ (i+1) + '=input') != -1) {
          inputs += (txt_values.indexOf('port'+ (i+1) + '=1') != -1)?"1":"0";
        } else if (txt_directions.indexOf('port'+ (i+1) + '=output') != -1) {
          outputs += (txt_values.indexOf('port'+ (i+1) + '=1') != -1)?"1":"0";
        } else {
          i = 8;
        }
      }


      IO_Status[0] = "output";
      IO_Status[1] = "output";
      var IOStateO = outputs;

      for (k = 0; k < (1+1); k++)
      {
        if( IO_Status[k] == "output" && form["root_IOPort_I" + k + "_Output_Name"] ) {
          try {
            var OutputName = form["root_IOPort_I" + k + "_Output_Name"].value;
            var unit = form["root_IOPort_I" + k + "_Output_PulseTime"].value;
            var buttontype = form["root_IOPort_I" + k + "_Output_Button"].value;

            for (j = unit.length-1; j >= 0; j--) {
              if (unit.charAt(j) == "h") {
                var value = parseInt(unit, 10) * 10;
                var displayValue = parseFloat(unit)/100;
                break;
              } else if (unit.charAt(j) == "s") {
                var value = parseInt(unit, 10) * 1000;
                var displayValue = parseInt(unit, 10);
                break;
              }
            }

            if (buttontype != "none")
            {
              var elArr = new Array();

              if (buttontype == "actinact")
              {
                var initStatus = false;
                if ((IOStateO.charAt(k) == '1' && form["root_IOPort_I" + k + "_Output_Active"].value == "closed") ||
                    (IOStateO.charAt(k) == '0' && form["root_IOPort_I" + k + "_Output_Active"].value == "open") == true)
                {
                  initStatus = true;
                }

                elArr.push({
                  type: "toggle",
                  name: OutputName,
                  nameActive: "buttonOn0" + k,
                  nameInactive: "buttonOff0" + k,
                  picActivePressed: "/pics/on_blue_pressed_button_27x27px.gif",
                  picActive: "/pics/on_blue_button_27x27px.gif",
                  picInactivePressed: "/pics/off_blue_pressed_button_27x27px.gif",
                  picInactive: "/pics/off_blue_button_27x27px.gif",
                  urlActive: "JavaScript:triggerActInactButton(true, " + [k + 1] + ")",
                  urlInactive: "JavaScript:triggerActInactButton(false, " + [k + 1] + ")",
                  initStatusActive: initStatus,
                  altActive: langObjView.getText("actTxt")+" "+ [OutputName],
                  altInactive: langObjView.getText("inaTxt")+" "+ [OutputName]
                });

              }
              else if (buttontype == "pulse")
              {
                elArr.push({
                  type: "button",
                  pic: "/pics/pulse_blue_button_27x27px.gif",
                  alt: langObjView.getText("pls1Txt")+" " + [OutputName] + " "+langObjView.getText("pls2Txt")+" " + [displayValue] + " "+langObjView.getText("pls3Txt"),
                  url: "JavaScript:triggerPulseButton("+ [k+1] + ", "+ value +")",
                  name: "PulseOff0" + [k],
                  pressed: "/pics/pulse_blue_button_pressed_27x27px.gif"
                });
              }
              outputBox(OutputName, elArr, true);
            }
          }
          catch(e) {}
        }
      }
    }
  }




  function addSelectOption(selectEl, nodeValue, nodeText, isSelected, cls, beforeIndex) {
    var op = document.createElement("option");
    op.value = nodeValue;
    op.text = nodeText;
    op.selected = isSelected;

    if (cls) {
      op.className = cls;
    }

    if (beforeIndex && beforeIndex < selectEl.length) {
      selectEl.options.add(op, beforeIndex);
    } else {
      selectEl.options.add(op);
    }
  }

  function clearSelect(el, keepFirst) {
    var removeTo = ((keepFirst)?1:0);

    while(el.length > removeTo) {
      el.remove( removeTo );
    }
  }


  // Draw the sequence buttons and the list of sources
  var showSourceList = true;
  function drawSequenceButtons()
  {

    var boxTitle;
    var elArr = new Array();

    if (showSourceList && (1 > 1
        || document.listFormExt.elements.length > 0))
    {
      boxTitle = "<br>";
    } else {
      boxTitle = "<br>";
    }

    if ((("yes" != "yes") || ("no" == "yes")) && (seq_sources > 1))
    {
      elArr.push( {type: "button", pic: "/pics/button_sequence_27x27px.gif", alt: langObjView.getText("viewSeqModTxt"), url: "JavaScript:sequence()" } );
      elArr.push( {type: "button", pic: "/pics/button_one_27x27px.gif", alt: langObjView.getText("segModeStopTxt") } );
    }
    else
      elArr.push( {type: "button", pic: "/pics/space.gif", width: "1px" } );
    elArr.push({type: "empty"});

    outputBox(boxTitle, elArr, false, false, true);
  }

  // Draw the trigger buttons
  function drawTriggerButtons()
  {
    addTriggerButtons(langObjView.getText("triTxt"), 0);
  }

  function addTriggerButtons(button_name, indx)
  {
    if (document.WizardForm["root_Layout_Trigger_T" + indx + "_Enabled"].value != "yes")
      return;

    var elArr = new Array();
    elArr.push( {type: "button", pic: "/pics/on_blue_button_27x27px.gif",
                        alt: button_name +" "+langObjView.getText("onTxt"),
                        url:  "JavaScript:triggerManualButton(true, "+indx+")",
                        name: "buttonOn",
                        pressed: "/pics/on_blue_pressed_button_27x27px.gif" } );
    elArr.push( {type: "button", pic: "/pics/off_blue_button_27x27px.gif",
                        alt: button_name +" "+langObjView.getText("offTxt"),
                        url:  "JavaScript:triggerManualButton(false, "+indx+")",
                        name: "buttonOff",
                        pressed: "/pics/off_blue_pressed_button_27x27px.gif" } );

    outputBox(button_name, elArr, false, true);
  }

  function triggerManualButton(activate, indx) {
    var activateStatus = !!activate ? "/" : "%5C";
    var cgiUrl = "/axis-cgi/io/virtualinput.cgi?action=" + [indx + 6] + ":"+activateStatus;
    AxisConnectionFactory.sendAsync(["GET", cgiUrl], (new Date()).getTime(), null, null);
  }

  function triggerPulseButton(indx, indx2) {
    var cgiUrl = "/axis-cgi/io/port.cgi?action=" + indx + ":/" + indx2 + "%5C";
    AxisConnectionFactory.sendAsync(["GET", cgiUrl], (new Date()).getTime(), null, null);
  }

  function triggerActInactButton(activate, indx) {
    var activateStatus = !!activate ? "/" : "%5C";
    var cgiUrl = "/axis-cgi/io/port.cgi?action=" + indx + ":"+activateStatus;
    AxisConnectionFactory.sendAsync(["GET", cgiUrl], (new Date()).getTime(), null, null);
  }

  function triggerCustomCgi(linkId) {
    var cgiUrl = document.getElementById(linkId).getAttribute('customlink');
    cgiUrl = decodeURI(cgiUrl);

    try {
      var url = cgiUrl.split('?'),
      data = {},
      arguments = [],
      arg;

      if(url.length > 1) {
        arguments = url[1].split("&");
      }

      $.each(arguments, function(index, argument) {
        arg = argument.split("=");
        data[arg[0]] = arg.length > 1 ? arg[1] : "";
      });

      $.get(url[0], data);
    }
    catch(e) {
    }
 }

  function getTriggerIndex() {
    var triggerIndex = 0;
    var camnbr = '1';
    var triggerIndex = parseInt(camnbr, 10);
    if( !isNaN(triggerIndex) ) {
      triggerIndex--;
    }
    else {
      triggerIndex = 0;
    }

    return triggerIndex;
  }


  var theTempDevice = AxisConnectionFactory.createAjaxConnection();

  function startTemperatureControl(device, id)
  {
    var now = new Date();
    AxisConnectionFactory.sendSync(["GET", "/axis-cgi/temperaturecontrol.cgi?device=" + device + "&id=" + id + "&action=start&timestamp="+now.getTime()], "", theTempDevice);
  }

function setHrefForSetup()
{


  // Workaround for IE7 that doesn't handle location.host correctly with IPv6.
  var axoper_new = "http";
  var axadmin_new = "http";
  var user_realm = 3;


  var addressPart2 = "";
  addressPart2 = "/operator/basic.shtml?id=8453";

  document.getElementById("view_SetTxt1").href = addressPart2;
  if (user_realm === 3) {
    var currentProtocol = window.location.protocol.replace(':', '');
    if (currentProtocol !== axoper_new && axoper_new !== "both") {
      $("#view_SetTxt1").css("color", "red");
    }
  }
}

function globalLanguageVars()
{
  var qtPlayer = document.getElementById("QTPlayer");
  var amaPlayer = document.getElementById("AMAPlayer");

  setHrefForSetup();


  if (qtPlayer == null && amaPlayer == null)
    drawScaleButtons();

  writeFormatOptions();


  requestIOPortStates();




  drawSequenceButtons();



  document.getElementById("view_HelpTxt").innerHTML = langObjView.getText("helpTxt");
  document.getElementById("view_LViewTxt").innerHTML = langObjView.getText("lViewTxt");
  document.getElementById("view_SetTxt1").innerHTML = langObjView.getText("settTxt");

}

var playclip_request = AxisConnectionFactory.createAjaxConnection();
playclip_request.setOverrideMimeType("text/plain");

function playclip()
{
  var audioclip = document.getElementsByName("audioclip")[0].value;
  if (audioclip == "") {
    return;
  }

  var url;
  url = "/axis-cgi/playclip.cgi?";
  url += "clip=" + audioclip + "&timestamp=" + (new Date()).getTime();

  AxisConnectionFactory.sendAsync(["GET", url], "", function playclip_request_onchange() {
    try {
      if (typeof(playclip_request) !== 'object'
          || playclip_request.getReadyState() !== 4) {
        return;
      }

      var responseText = playclip_request.getResponseText();
      if (responseText.length === 0) {
        return;
      }

      var alreadyPlayingErrors = [
        "Failed to receive audio, already receiving",
        "Audio clip is already playing"
      ];

      // Check if the audio-clip is already playing
      for (var i in alreadyPlayingErrors) {
        if (responseText.indexOf(alreadyPlayingErrors[i]) != -1) {
          alert( langObjView.getText("playAlertPlaying") );
          return;
        }
      }

      // No, check for other errors
      if (responseText.indexOf("OK") == -1) {
        alert( langObjView.getText("playAlert") );
      }
    } catch (e) { }
  }, playclip_request);
}
function extractVideoNbr(theParamPos)
{
  var i = 0;
  var start, stop;
  var len;
  var colonCount = 0;

  while (theParamPos.charAt(i++) != '~' && i < theParamPos.length);
  if (i >= theParamPos.length) {
    return -1;
  }
  while (colonCount < 6 && i < theParamPos.length) {
    if (theParamPos.charAt(i++) == ':') {
      colonCount++;
      if (colonCount == 4)
        start = i;
      if (colonCount == 5)
        len = i-2-start+1;
    }
  }
  if (i < theParamPos.length && len > 0)
    return parseInt(theParamPos.substr(start,len), 10);
  else
   return -1;
}

function extractPresetNbr(name)
{
  var nbr = name.slice(20, -4)
  return parseInt(nbr, 10)
}


function getNewImageSource( camera_nbr )
{
  var imageSource;
  imageSource = "/mjpg/video.mjpg"+(( camera_nbr != null && camera_nbr != "" )?"?camera=" + camera_nbr:"");

  return imageSource;
}


function listVideoSources()
{
  var formInt = document.listFormInt;
  var formExt = document.listFormExt;
  var formCrop = document.listFormCrop;
  var presetForm = document.listFormPreset;
  var form = document.WizardForm
  var currentPath = decodeEncodingJavascript('/mjpg/video.mjpg');
  var imageSource;
  var opArr = new Array();
  var opSelected = false;
  var opVal = "";
  var opText = "";

  if ((1 > 1)
       || presetForm.elements.length > 0
       || ext_sources > 0
     ) {

    if (
      (1 == 1)
         && (presetForm.elements.length > 0)
         && ext_sources == 0
       ) {
      opArr.push({val: "no_change", text: "----------------"});
    }

    // ***** PTZ presets *****
    var prevReqCam = 1;
    if (currentPath.indexOf("camera") != -1) {
      var tmpStr = currentPath.substring(currentPath.indexOf("camera")+7);
      prevReqCam = (tmpStr.indexOf("&") != -1 )?tmpStr.substr(0, tmpStr.indexOf("&") ):tmpStr.substr(0);
    }
    var curpreset = decodeURIComponent("");
    if (currentPath.indexOf("gotopresetname") != -1) {
      if (currentPath.lastIndexOf("&") > currentPath.lastIndexOf("gotopresetname="))
        curpreset = decodeURIComponent(currentPath.substring(currentPath.lastIndexOf("gotopresetname=")+15, currentPath.lastIndexOf("&")-1))
      else
        curpreset = decodeURIComponent(currentPath.substr(currentPath.lastIndexOf("gotopresetname=")+15))
    }
    for (i = 0; i < 1; i++) {
      if (presetForm.elements.length >= 0) {
        for (var j = 0; j < presetForm.elements.length; j++) {
          var tmpArray = presetForm.elements[j].name.split("_");
          if (tmpArray[tmpArray.length - 1] == "Name") {
            var label = encodeURIComponent(presetForm[j].value);
            var currentPresetId = String( presetForm.elements[j].name ).replace("root_PTZ_Preset_P", "").split("_")[0];

            if (currentPresetId != i) {
              continue;
            }
            var videoNbr = i + 1;
            var group = tmpArray[tmpArray.length - 2];

            if (videoNbr-1 == i)
            {
                var tmpOpt = 'gotopresetname=' + label;

                if (currentPath.indexOf('?') >= 0)
                  tmpOpt = '&' + tmpOpt;
                else
                  tmpOpt = '?' + tmpOpt;

                opSelected = false;
                opVal = currentPath + tmpOpt;
              if (decodeURIComponent(label) == curpreset && videoNbr == prevReqCam)
                opSelected = true;
              opText = decodeURIComponent(label).crop(25, "...");
              opArr.push( {val: opVal, text: opText, selected: opSelected} );
            }//if videoNbr-1 == i
          }
        }
      }
    }
var viewAppletIE = "no";
var viewAppletOther = "no";
// Don't show external sources while using Java applet as Default Viewer. An unsigned applet doesn't have permission to access remote hosts.
    if (((browser == "IE") && (viewAppletIE == "no")) || ((browser != "IE") && (viewAppletOther == "no")))
    {
      if (formExt.elements.length > 0)
      {
        for (i = 0; i < formExt.elements.length; i += 3)
        {
          var aTempString = formExt.elements[i].name
          var videoNr = aTempString.substring(20, aTempString.lastIndexOf('_'))
          var external = formExt['root_ExternalVideo_E' + videoNr + '_ImagePath'].value;

            opSelected = false;

            if (formExt['root_ExternalVideo_E' + videoNr + '_ImagePath'].value == currentPath)
              opSelected = true;
            opArr.push( {val: external, text: formExt['root_ExternalVideo_E' + videoNr + '_Name'].value, selected: opSelected} );
        }
      }
    }

    var selectBox = document.getElementById("videoList");
    if (selectBox) {
      var td = selectBox.parentNode,
          extraButton = document.createElement("input");
      if(td.getElementsByTagName('input').length === 0) {
        extraButton.type = "button";
        extraButton.value = langObjView.getText("goBtn");
        extraButton.onclick = selectView;
        extraButton.width = "40";
        td.appendChild(extraButton);
      }

      clearSelect(selectBox, false);
      selectBox.onchange = selectView;
      selectBox.disabled = false;


      for (var i = 0; i < opArr.length; i++) {
        addSelectOption(selectBox, opArr[i].val, opArr[i].text, opArr[i].selected);
      }

    }
  }
}

function updatePresetNames(presetsArray) {
  var pForm = document.getElementsByName("listFormPreset")[0],
      formElements = [];

  formElements = pForm.elements;
  for (var presetName in presetsArray) {
    if (presetName.indexOf("_Name") > -1) {
      if (formElements[presetName] && formElements[presetName].name == presetName) {
        formElements[presetName].value = presetsArray[presetName];
      }
    }
  }

  listVideoSources();
}

function zoom(size)
{
  var url = document.URL;

  if (url.indexOf("?") == -1) {
    url += "?size=" + size
  } else if (url.indexOf("size=") == -1) {
    url += "&size=" + size
  } else {
    var searchStr = "size=1"
    var replaceStr = "size=" + size
    var re = new RegExp(searchStr , "g")
    url = url.replace(re, replaceStr)
  }

  document.location = url;
}

var aNewImagePath;

function reloadPage()
{
  document.location = aNewImagePath;
}

  var gotopresetname = decodeURIComponent("");

function selectView()
{
    if (!showSourceList)
      return;
  var form = document.WizardForm;


  var oVideoList = form.videoList;
  var source = "no_change";
  if( oVideoList && oVideoList.selectedIndex >= 0 )
  {
    source = oVideoList.options[oVideoList.selectedIndex].value;
  }
  var params = source.split('&');
  var newCamera = null;
  var presetName = null;

  if ((params[1] != null) && ("no" == "no")) {
    if (source.lastIndexOf("camera=") != -1) {
      newCamera = source.substr(source.lastIndexOf("camera=")+7);
      if (newCamera.indexOf("&") != -1) {
        newCamera = newCamera.substring(0, newCamera.indexOf("&"));
      }
    }
    else {
      newCamera = 1;
    }

    if (source.lastIndexOf("gotopresetname=") != -1) {
      presetName = source.substr(source.lastIndexOf("gotopresetname=")+15);
      if (presetName.indexOf("&") != -1 ) {
        presetName = presetName.substring(0, presetName.indexOf("&"));
      }
    }
    source = params[0];
    for (var p = 1; p < params.length; p++)
    {
      if (params[p].indexOf("gotopreset") == -1)
        source += "&" + params[p];
    }
  }
  else if (source.lastIndexOf("gotopresetname=") != -1) {
    presetName = source.substr(source.lastIndexOf("gotopresetname=")+15);
    newCamera = 1;

    params = source.split('?');
    source = params[0];
  }
  else if (source == "no_change")
  {
    return;
  }

  if (presetName != null) gotopresetname = presetName;

  var opt = null;

  source = decodeURIComponent(source);

  changeView(source, newCamera, presetName, null, opt);
}

function changeView(imagePath)
{
  var args = changeView.arguments;
  var newCamera  = (args.length >= 2 ? args[1] : null);
  var presetName = (args.length >= 3 ? args[2] : null);
  var newSize    = (args.length >= 4 ? args[3] : null);
  var other      = (args.length >= 5 ? args[4] : null);

  // Go to correct preset when coming from an external video source
  if ((presetName == null || presetName == "") && (imagePath.indexOf("gotopresetname=") != -1)) {
    presetName = imagePath.slice(imagePath.indexOf("gotopresetname=") + 15)
    if (presetName.indexOf("&") != -1)
      presetName = presetName.substring(0, presetName.indexOf("&"))
  }
  if ((newCamera == null || newCamera == "") && (imagePath.indexOf("camera=") != -1)) {
    newCamera = imagePath.slice(imagePath.indexOf("camera=") + 7)
    if (newCamera.indexOf("&") != -1)
      newCamera = newCamera.substring(0, newCamera.indexOf("&"))
  }

  var reload = false;
  // the whole Live View design is built on page reload >-(
  // must reload initial sequence mode view to toggle buttons etc
  reload |= (other != null && other.search("seq=yes") >= 0);
      var streamprofile = "";
      if (other != null && other.indexOf("streamprofile=") != -1) {
        streamprofile = other.slice(other.indexOf("streamprofile=") + 14);
        if (streamprofile.indexOf("&") != -1) {
          streamprofile = streamprofile.substring(0, streamprofile.indexOf("&"));
        }
      }
      reload |= (other != null && ('' != streamprofile));
  reload |= (imagePath != decodeEncodingJavascript('/mjpg/video.mjpg'));


  if ((presetName != null) && (presetName != "")) {
    var prevCamera = '1';
    // set new image path
    if (prevCamera == 'quad') {
      imagePath = imagePath.replace(/quad/, newCamera);
      reload = true;
    } else if (prevCamera != newCamera) {
      imagePath = imagePath.replace("/" + prevCamera + "/", "/" + newCamera + "/");
      reload = true;
    }
    var oLocked = document.getElementsByName("root_PTZ_Various_V" + newCamera + "_Locked")[0];
    if (!reload && oLocked && oLocked.value != "true")
    if (presetName != "Home")
      gotoPreset(newCamera, presetName);
  }
  if (reload) {
    var size = newSize;

    if (size == null) {
      size = 1;
    }
    if (size != null) {
      size = '&size=' + size;
    }
    aNewImagePath = '/view/view.shtml?id=8453&imagePath=' + encodeURIComponent(imagePath) + size;
    if (other != null)
      aNewImagePath += other;
    /* append preset parameters so that preset postion is selected in drop down list after reload */
    if (presetName != '' && presetName != null)
      aNewImagePath += "&gotopresetname=" + encodeURIComponent(presetName);
    else if (gotopresetname != '' && gotopresetname != null)
      aNewImagePath += "&gotopresetname=" + encodeURIComponent(gotopresetname);

    if( newCamera != '' && newCamera != null )
      aNewImagePath += "&camera=" + encodeURIComponent(newCamera);
    reloadPage();
  }
  else if (other != null) {
    selectSource(newCamera, presetName);
  }
}

var ajaxRequest = AxisConnectionFactory.createAjaxConnection();
ajaxRequest.setOverrideMimeType("text/plain");
function gotoPreset(camera, presetName)
{
  var now = new Date();


  var speed = parseInt("100", 10);

  var url = "/axis-cgi/com/ptz.cgi?gotoserverpresetname=" + presetName + "&camera=" + camera + "&timestamp="+now.getTime()  +"&speed=" + speed;

  if (ajaxRequest.getReadyState() > 0 || ajaxRequest.getReadyState() < 4)
    ajaxRequest.abort();

  AxisConnectionFactory.sendAsync(["GET", url], "", ajaxRequest_onchange, ajaxRequest);
}

function ajaxRequest_onchange()
{
  if (typeof(ajaxRequest) == 'object' && ajaxRequest.getReadyState() == 4) {
    try {
      if (ajaxRequest.getStatus() == 200 && ajaxRequest.getResponseText().length > 0)
      {
        var errorMessage;
        var responseText = ajaxRequest.getResponseText();
        if(responseText.indexOf("<HTML>") != -1 || responseText.indexOf("<html>") != -1)
        {
          var headStartPos = responseText.indexOf("<HEAD>");
          if(headStartPos == -1)
            headStartPos = responseText.indexOf("<head>");
          var headEndPos = responseText.indexOf("</HEAD>")+7;
          if(headEndPos == -1)
            headEndPos = responseText.indexOf("</head>")+7;

          responseText = responseText.replace(responseText.slice(headStartPos, headEndPos),"");
          var re= /<\S[^>]*>/g;
          errorMessage = responseText.replace(re,"");
        } else {
          if (responseText.indexOf("Control is not possessed - request put in control queue.") >= 0) {
            errorMessage =langObjPTZIncl.getText("ptzInclContrlPossessTxt");
          } else {
            errorMessage = responseText;
          }
        }

        alert(errorMessage);
      }
    } catch(e) {}
  }
}

function selectSource(newCamera, presetName) {
    if (!showSourceList)
      return;
  var options = document.WizardForm.videoList.options;
  var i = 0;
  var option;

  while ((option = options[i++]) != null) {
    if (presetName != null) {
      var presetStart = option.value.search('gotopresetname');
      if (presetStart != -1) {
        var preset = option.value.substring(presetStart).split('=');
        if (decodeURIComponent(preset[1]) == presetName) {
          option.selected = true;
          return;
        }
      }
    } else {
      var videoNbr = option.value.match(/\d/);
      if (videoNbr == null && newCamera == 1 || videoNbr == newCamera) {
        option.selected = true;
        return;
      }
    }
  }
}

var seqNext = null;

function doSequence(size) {
  var formSeq = document.listFormSeq;
  var formExt = document.listFormExt;
  var presetForm = document.listFormPreset;
  var seqSources = new Array();
  var seqNumbers = new Array();
  var seqTimes = new Array();
  var cameraNbr;
  var presetName = null;
  var imagePath;
  var next;

  for (var i = 0; i < formSeq['root_Sequence_S0_NbrOfSources'].value; i++) {
    seqSources[i] = formSeq['root_Sequence_S0_Source_S' + i + '_Type'].value;
    seqNumbers[i] = formSeq['root_Sequence_S0_Source_S' + i + '_Number'].value;
    seqTimes[i] = formSeq['root_Sequence_S0_Source_S' + i + '_Time'].value;
  }

  if (seqNext != null) {
    next = seqNext;
  } else {
    next = 0;
  }

  imagePath = "";
  if (seqSources[next] == 'Ext') {
    imagePath = formExt['root_ExternalVideo_E' + seqNumbers[next] + '_ImagePath'].value;
  }
  else if (seqSources[next] == 'Preset') {
    cameraNbr = 1
    presetName = presetForm['root_PTZ_Preset_P0_Position_P' + seqNumbers[next] + '_Name'].value;
  }
  else if (seqSources[next] == 'Quad') {
    cameraNbr = 'quad';
  } else {
    cameraNbr = parseInt(seqNumbers[next], 10) + 1;
  }

  if (imagePath == "") {
      imagePath = '/mjpg/video.mjpg';
  }

  var nextNext;
  if (formSeq['root_Sequence_S0_RandomEnabled'].value == "yes")
    nextNext = Math.floor(Math.random() * formSeq['root_Sequence_S0_NbrOfSources'].value);
  else
    nextNext = next + 1;
  if (nextNext >= formSeq['root_Sequence_S0_NbrOfSources'].value)
    nextNext = 0;

  seqNext = nextNext;
    changeView(imagePath, cameraNbr, presetName, size, '&seq=yes&next=' + nextNext + '&sequencetime=' + seqTimes[next]);

    t1 = setTimeout("doSequence(" + size + ")", 1000 * seqTimes[next]);
}


function snapshot(imagepath)
{
  var no = document.WizardForm.amount.value++
  var picturepath;
  var cgiurl = "/axis-cgi/jpg/image.cgi?camera=";
  var protEnd = imagepath.indexOf("://");
  var camIndex = imagepath.indexOf("camera=");

  if (imagepath.charAt(0) == '/' && protEnd < 0) {
    if (camIndex >= 0) {
      var secondEt = imagepath.indexOf('&', camIndex);
      var camnbr = imagepath.substring(camIndex + 7, (secondEt >= 0 ? secondEt : imagepath.length));
    } else {
      var afterfirstSlash = imagepath.indexOf('/', 1) + 1;
      var secondSlash = imagepath.indexOf('/', afterfirstSlash);
      var camnbr = imagepath.substring(afterfirstSlash, (secondSlash >= 0 ? secondSlash : imagepath.length));
    }
    if (camnbr != "quad" && isNaN(parseInt(camnbr, 10)))
      camnbr = 1;
    picturepath = cgiurl + camnbr;
  } else {
    if (imagepath.indexOf("h264") >= 0 || imagepath.indexOf("mpeg4") >= 0) {
      var prot = document.location.protocol;
      var imageHost = imagepath.substring(protEnd + 3, imagepath.indexOf('/', protEnd+3));
      var secondEt = imagepath.indexOf('&', camIndex);
      var camnbr = imagepath.substring(camIndex + 7, (secondEt >= 0 ? secondEt : imagepath.length));
      if (camnbr != "quad" && isNaN(parseInt(camnbr, 10)))
        camnbr = 1;
      picturepath = prot + "//" + imageHost + cgiurl + camnbr;
    } else {
      picturepath = imagepath.replace(/video/, "image").replace(/mjpg/g, "jpg");
    }
  }


  var pictureoptions = "";
  var url = picturepath + pictureoptions;
  var time = new Date()
  var timestamp = time.getTime()

  url += '&timestamp=' + timestamp + '&width=' + 1024
  openPopUp(url, 'Take_snapshot' + [no] + '', 1024 + 45, 768 + 75 )
}

var statusPtz_count_id;

var statusPtz_periodicRequest;
var statusPtz_periodicRequest_timeout;
var statusPtz_periodicRequest_interval;

var statusPtz_request;
var statusPtz_request_control = "request";
var statusPtz_request_timeout;


var statusPtz_update_id;
var statusPtz_update_response;

var langObjStatusPtz = new Language("incl_platoon_ptz", "statusPtz");
  var statusPtz_update_min_period = parseInt(20*0.75); //(seconds)
var statusPtz_update_seconds = 0; //(seconds left)
var statusPtz_update_position = 0;
var statusPtz_update_error = "";

function setStatusParams(response)
{
  var re = /\"\-{0,1}\d*\"/g;
  var a = response.match(re);
  var reF = /\"/g;
  if (a != null) {
    statusPtz_update_position   = parseInt(a[0].replace(reF, ""), 10);
    statusPtz_update_seconds    = parseInt(a[1].replace(reF, ""), 10);
    statusPtz_update_min_period = parseInt(a[2].replace(reF, ""), 10);
    statusPtz_update_error      = "";
  } else {
    response = response.replace(/<.*?>|\n|\r/ig, " ").trim();
    response = response.replace(/\s+/ig, " ");
    setStatusParams_error(response);
  }
}

function setStatusParams_error(error) {
  var cameraNumber = "";
  if (error.indexOf("Error: Control queuing is not enabled on camera") >=0) {
    cameraNumber = error.replace("Error: Control queuing is not enabled on camera ", "");
    statusPtz_update_error = langObjStatusPtz.getText('stPtzQueNotEnabledTxt', {cameraNumber: cameraNumber});
  }
  else {
    statusPtz_update_error = error;
  }
    statusPtz_update_min_period    = parseInt(20*0.75);
  statusPtz_update_position      = 0;
  statusPtz_update_seconds       = 0;
}

function updateStatus()
{
  var lbl = document.getElementsByName("ptzqlabel")[0];
  var tleft = document.getElementsByName("ptzqtleft")[0];
  var pos = document.getElementsByName("ptzqpos")[0];
  var status = document.getElementsByName("ptzqstatus")[0]
  if (statusPtz_update_error.length == 0) {
    tleft.value = ((statusPtz_update_seconds == -1) ?  langObjStatusPtz.getText("stPtzUnlimTxt"): statusPtz_update_seconds);
    if (statusPtz_update_position == "0") {
      lbl.value = langObjStatusPtz.getText("stPtzReqCtrlTxt");
      statusPtz_request_control = "request";
      pos.value = "";
      if (statusPtz_update_seconds == "0") {
        status.value = langObjStatusPtz.getText("stPtzNoHigherQueTxt");
        //Restarts poll for position
        if (typeof(getPtzPositions) == "function" && !ptzPosInterval)
          getPtzPositions();
      } else {
        status.value = langObjStatusPtz.getText("stPtzHigherQueTxt");
      }
    } else {
      pos.value = statusPtz_update_position;
      statusPtz_request_control = "drop";
      if (statusPtz_update_position == "1") {
        status.value = langObjStatusPtz.getText("stPtzPossessingTxt");
        lbl.value = langObjStatusPtz.getText("stPtzReleaseTxt");
        //Restarts poll for position
        if (typeof(getPtzPositions) == "function" && !ptzPosInterval)
          getPtzPositions();
      } else {
        status.value = langObjStatusPtz.getText("stPtzQuedTxt");
        lbl.value = langObjStatusPtz.getText("stPtzLeaveQueTxt");
      }
    }
  }
  else
  {
    // some error has occurred
    if(status)
    {
      status.value = statusPtz_update_error;
      pos.value = "";
      tleft.value = "";
    }
    ctlStop();
  }
}


function ctlReq()
{
  switch(statusPtz_request_control)
  {
    case "request":
      sendStatusRequest("request")
      break;
    case "drop":
      sendStatusRequest("drop")
      break;
  }
}

function sendStatusRequest(action)
{
  if (!statusPtz_request)
    ctlStart();

  var now = new Date();
  AxisConnectionFactory.sendAsync(["GET", "/axis-cgi/com/ptzqueue.cgi?control=" + action + "&tagresponse=yes&camera=1&timestamp=" + now.getTime()], "", statusPtz_request_stateChange, statusPtz_request);
  delete now;
  statusPtz_request_timeout = window.setTimeout(statusPtz_request_timedout, 10000);
}

function statusPtz_request_stateChange()
{
  window.clearTimeout(statusPtz_request_timeout);
  var readyState = statusPtz_request.getReadyState();
  if (readyState == 4) {
    var status = statusPtz_request.getStatus();
    if (status == 200) {
      setStatusParams(statusPtz_request.getResponseText());
    } else if (status != 204 && status != 1223) {
      setStatusParams_error(status + " - " + statusPtz_request.getStatusText())
    }
    if (status != 401) {
      statusPtz_periodicRequest_start();
    }
  } else if (readyState == 0) {
    setStatusParams_error(langObjStatusPtz.getText("stPtzAbortedTxt"));
    statusPtz_periodicRequest_start();
  }
}

function statusPtz_request_timedout()
{
  statusPtz_request.abort();
}

function sendPeriodicRequest()
{
  var readyState = statusPtz_periodicRequest.getReadyState();
  if (readyState != 0 && readyState != 4)
    return;
  var now = new Date();
  AxisConnectionFactory.sendAsync(["GET", "/axis-cgi/com/ptzqueue.cgi?control=query&tagresponse=yes&camera=1&timestamp=" + now.getTime()], "", statusPtz_periodicRequest_stateChange, statusPtz_periodicRequest);
  delete now;
  statusPtz_periodicRequest_timeout = window.setTimeout(statusPtz_periodicRequest_timedOut, 10000);
}

function statusPtz_periodicRequest_stateChange()
{
  window.clearTimeout(statusPtz_periodicRequest_timeout);
  var readyState = statusPtz_periodicRequest.getReadyState();
  if (readyState == 4) {
    var status = statusPtz_periodicRequest.getStatus();
    if (status == 200) {
      setStatusParams(statusPtz_periodicRequest.getResponseText());
    } else if (status != 204 && status != 1223) {
      setStatusParams_error(status + " - " + statusPtz_periodicRequest.getStatusText())
    }
    updateStatus();
  } else if (readyState == 0) {
    setStatusParams_error(langObjStatusPtz.getText("stPtzAbortedTxt"));
    updateStatus();
  }
}

function statusPtz_periodicRequest_timedOut()
{
  statusPtz_periodicRequest.abort();
}

function statusPtz_periodicRequest_start()
{
  if (statusPtz_periodicRequest_interval)
    window.clearInterval(statusPtz_periodicRequest_interval);
  if (statusPtz_periodicRequest_timeout)
    window.clearTimeout(statusPtz_periodicRequest_timeout);

  sendPeriodicRequest();
  statusPtz_periodicRequest_interval = window.setInterval(sendPeriodicRequest, statusPtz_update_min_period * 1000);
}

function handleCtlReq()
{
  window.clearTimeout(statusPtz_update_id);
  sendStatusRequest("request");
  // restart timeout to be sure update will be done in time.
  statusPtz_update_id = window.setTimeout(updateStatus, 2000);
}

function handleCtlDrop(form)
{
  window.clearInterval(statusPtz_count_id);
  window.clearTimeout(statusPtz_update_id);
  sendStatusRequest("drop");
  // restart - but wait a while to be sure the above form is sent.
  statusPtz_update_id = window.setTimeout(ctlStart, 500);
}

function ctlStart()
{
  if (typeof AxisConnectionFactory == "undefined" || typeof AxisConnection == "undefined") {
     window.setTimeout(ctlStart, 500);
     return;
   }

  if (!statusPtz_periodicRequest)
  {
    statusPtz_periodicRequest = AxisConnectionFactory.createAjaxConnection();
    statusPtz_periodicRequest.setOverrideMimeType( 'text/plain' );
  }
  if (!statusPtz_request)
  {
    statusPtz_request = AxisConnectionFactory.createAjaxConnection();
    statusPtz_request.setOverrideMimeType( 'text/plain' );
  }
  statusPtz_periodicRequest_start();

  startCountDown();
}

function ctlRepeat()
{
  statusPtz_periodicRequest_start();
}

function ctlStop()
{
  // reset label + action
  var lbl = document.getElementsByName("label")[0];
  if(lbl)
    lbl.value = langObjStatusPtz.getText("stPtzReqCtrlTxt");
  statusPtz_request_control = "request";
  // stop timers
  window.clearInterval(statusPtz_count_id);
  window.clearTimeout(statusPtz_update_id);
}

function startCountDown()
{
  statusPtz_count_id = window.setInterval(countDown, 1000);
}

function countDown()
{
  if (document.getElementsByName("ptzqtleft")[0] &&
    document.getElementsByName("ptzqtleft")[0].value != "")
  {
    var t = parseInt(document.getElementsByName("ptzqtleft")[0].value, 10);
    if (t > 0)
    {
      document.getElementsByName("ptzqtleft")[0].value = t - 1;
    }
  }
}
function movepic(img_name, img_src)
{
  var element = document.getElementById(img_name+"_link");
  if (element)
    element.firstChild.src = img_src;
}

function auto(Path)
{
  parent.frames[1].location = Path
}

function AbsoluteOrRelative(form)
{
  var url = document.URL;
  var relative = "yes_no_cross";
  var oAbsOrRel = form.AbsOrRel;
  if ( oAbsOrRel && oAbsOrRel.selectedIndex == 0)
    relative = "no";
  if (url.indexOf("?") == -1) {
    url += "?relative=" + relative;
  } else if (url.indexOf("relative=") == -1) {
    url += "&relative=" + relative;
  } else {
    var searchStr = "relative=";
    var replaceStr = "relative=" + relative;
    var re = new RegExp(searchStr , "g");
    url = url.replace(re, replaceStr);
  }
  document.location = url;
} 


var stillImagePath;
var fullImagePath = "";
var use_activex = 0;
var use_java = 0;
var use_spush = 0;
var use_flash = 0;
var use_still = 0;
var IEBrowser = isBrowserIE();
var use_quicktime = 0;
var rotation_in_url = "";
  var rotation_in_parhand = "0";
var resolution_in_url = "";
var resolution_in_parhand = "1024x768";
var resolutions = "1280x960&#44;1024x768&#44;800x600&#44;640x480&#44;480x360&#44;320x240&#44;240x180&#44;160x120&#44;1280x720&#44;800x450&#44;640x360&#44;480x270&#44;320x180&#44;160x90&#44;1280x800&#44;176x144";
var streamprofile_in_url = "";
var recording = "";
var zoom_fact = "";
var detectedType = "PAL";
var isSquarePixelEnabled = (""=== 'yes') ? true: false;
var aspectRatio = "";
  var ShowAMCToolbar = "yes";
var isTilted = false;
var videoWidth = 0;
var videoHeight = 0;
var amcToolbarHeight = 54;
function IPAddress(path)
{
  var str = path.slice(7);
  var anArray = str.split('/');

  if (anArray[0].split(":").length > 1)
  {
    anArray[0] = "[" + anArray[0] + "]";
  }
  return anArray[0];
}

try
{
  var langObjVideo = new Language("common", "video");
}
catch(e)
{
  delete e;
function Language_backwardcomp()
{
  this.init = function(whatever)
  {
    window.focus();
  }

  this.getText = function(id)
  {
    var arr = new Array();
    arr["notAutTxt1"] = "The installation of the MPEG-4";
    arr["notAutTxt2"] = "Decoder has been disabled. Contact the Administrator of this";
    arr["notAutH264Txt"] = "The installation of the H.264 Decoder has been disabled. Contact the Administrator of this";
    arr["autTxt"] = "Click here to install or upgrade the MPEG-4";
    arr["decoderDotTxt"] = "Decoder.";
    arr["autH264Txt"] = "Click here to install or upgrade the H.264 Decoder.";
    arr["instDecoder1_1Txt"] = "<b>MPEG-4";
    arr["instDecoder1_2Txt"] = "Decoder</b>, which enables streaming video in Microsoft Internet Explorer, has not been installed or could not be registered on this computer.";
    arr["instDecoder1H264Txt"] = "<b>The H.264 Decoder</b>, which enables streaming video in Microsoft Internet Explorer, has not been installed or could not be registered on this computer.";
    arr["instDecoder2_1Txt"] = "To install or upgrade the MPEG-4";
    arr["instDecoder2_2Txt"] = "Decoder, you must have Administration rights on this computer and you must answer Yes <br>when asked if you wish to allow the installation.";
    arr["instDecoder2_3Txt"] = "can also be configured to show still images.";
    arr["instDecoder2_1H264Txt"] = "To install or upgrade the H.264 Decoder, you must have Administration rights on this computer and you must answer Yes <br>when asked if you wish to allow the installation.";
    arr["instDecoder2_2H264Txt"] = "can also be configured to show still images.";
    arr["notAutAacTxt"] = "The installation of the AAC Decoder has been disabled. Contact the Administrator of this";
    arr["autAacTxt"] = "Click here to install or upgrade the AAC Decoder.";
    arr["instAacDecoder1Txt"] = "<b>AAC Decoder</b>, which enables streaming AAC audio in Microsoft Internet Explorer, has not been installed or could not be registered on this computer.";
    arr["instAacDecoder2Txt"] = "To install or upgrade the AAC Decoder, you must have Administration rights on this computer and you must answer Yes <br>when asked if you wish to allow the installation.";
    arr["inst1Txt"] = "which enables streaming";
    arr["vidTxt"] = "video";
    arr["audTxt"] = "audio";
    arr["inst2Txt"] = "in Microsoft Internet Explorer, has not been installed<br> or could not be registered on this computer.";
    arr["inst3Txt"] = "To install or upgrade the";
    arr["inst4_1Txt"] = ", you must have Administration rights on this computer and you must answer Yes <br>when asked if you wish to allow the installation. <br>Click on the yellow banner to begin the installation. If the banner is not visible, turn off pop-up blockers<br>from the Tools menu in Microsoft Internet Explorer.<br>";
    arr["inst4_2Txt"] = "can also be configured to show still images.";
    arr["prReIfTxt"] = "Press Reload if no image is displayed";
    arr["noImageTxt"] = "If no image is displayed, there might be too many viewers, or the browser configuration may have to be changed. See help for detailed instructions on how to do this.";
    arr["videoTxt"] = "<b>Video</b>";
    arr["ptzTxt"] = "<b>PTZ</b>";
    arr["stoStrTxt"] = "Stop stream";
    arr["staStrTxt"] = "Start stream";
    arr["snapsTxt"] = "Snapshot";
    arr["centTxt"] = "Center";
    arr["joysTxt"] = "Joystick";
    arr["zoomTxt"] = "Zoom";
    arr["zooWidTxt"] = "Zoom wide";
    arr["crosshTxt"] = "Crosshair";
    arr["qtDoNoSupTxt"] = "QuickTime does not support the current MPEG-4 setting.<br>Go to Setup->Video&Image->Advanced->MPEG-4 and set Video object type to 'Simple' for QuickTime to work.";
    arr["needFlashPluginTxt"] = "You need a Shockwave Flash plugin, get it from:";
    arr["yoBrDoNoSuJaTxt"] = "Your browser does not support Java";

	  if( arr[id] != null )
	    return arr[id];
	  return "";
  }

  this.getLanguageCode = function(langInUse, isAMC)
  {
    var currentLang = langInUse.toLowerCase();

    var langArr = new Array();
    langArr["english"] = { amc: "eng", axis: "en" };
    langArr["portugese"] = { amc: "por-br", axis: "pt" };
    langArr["chinese"] = { amc: "chi", axis: "zh" };
    langArr["french"] = { amc: "fre", axis: "fr" };
    langArr["german"] = { amc: "ger", axis: "de" };
    langArr["italian"] = { amc: "ita", axis: "it" };
    langArr["japanese"] = { amc: "jpn", axis: "ja" };
    langArr["spanish"] = { amc: "spa", axis: "es" };
    langArr["korean"] = { amc: "kor", axis: "ko" };
    langArr["russian"] = { amc: "rus", axis: "ru" };

    var choosenLangCode = "";

    if(isAMC)
      choosenLangCode = langArr[currentLang].amc;
    else
      choosenLangCode = langArr[currentLang].axis;

    return choosenLangCode;
  }
}
  var langObjVideo = new Language_backwardcomp();
}

var minimap = "no";
var installText1, installLangText1, videoText, audioText, installText2, installText3, installText4, installLangText2;
function video(imagepath)
{
  langObjVideo.init(false, true);
  if (navigator.userAgent.indexOf("MSIE") !=-1 &&  navigator.userAgent.indexOf("x64") !=-1) {
    document.write('<center>');
    document.write(langObjVideo.getText("noSupIESFTxt"));
    document.write('</center>');
    return;
  }

  var resolution = 0;
  var width = 0;
  var height = 0;

  if (imagepath.indexOf("rotation=") != -1) {
    if (rotation_in_url == "90" || rotation_in_url == "270") {
      isTilted = true;
    } else if (rotation_in_url == "" && (rotation_in_parhand == "90" || rotation_in_parhand == "270")) {
      isTilted = true;
    }
  } else {
    if (rotation_in_parhand == "90" || rotation_in_parhand == "270") {
      isTilted = true;
    }
  }

  if (imagepath.indexOf("resolution=") != -1)
  {
    var resStart = imagepath.indexOf("resolution=")
    var resStop = imagepath.indexOf("&", resStart)
    if (resStop == -1)
      resStop = imagepath.length
    resolution = imagepath.substring(resStart + 11, resStop);
    if (resolution.indexOf('x') != -1)
    {
      width = parseInt(resolution.substring(0, resolution.indexOf('x')), 10);
      height = parseInt(resolution.slice((resolution.indexOf('x') + 1)), 10);
    }
  }

  if (!(width > 0 && height > 0))
  {
    if (typeof(img_width) == "number" && typeof(img_height) == "number" && img_width > 0 && img_height > 0)
    {
      width = img_width;
      height = img_height;
      resolution = width + 'x' + height;
    }
    else if ((imagepath.indexOf("mpeg4") != -1) || (imagepath.indexOf("h264") != -1))
    {
      width = parseInt("1024", 10);
      height = parseInt("768", 10);
      resolution = width + 'x' + height;
    }
    else
    {
      width = parseInt("1024", 10);
      height = parseInt("768", 10);
      resolution = width + 'x' + height;
    }
  }

  if (isNaN(width) || isNaN(height)) {
    if (typeof AXIS.CustomEventUtil !== "undefined") {
      document.write("<div id=\"streamPlaceholder\"></div>");

      AXIS.CustomEventUtil.publish("video:unsupportedResolution");
    }

    return;
  }

  if ('1' != '1')
  {
    var strSize = '1';
    var sizeNum = 0;
    //floating number try to parse it
    if( strSize.indexOf('.') != -1  )
    {
      sizeNum = parseFloat( strSize );
      //might be the wrong decimal separation
      if( sizeNum == 0 || isNaN( sizeNum ) )
      {
        strSize = strSize.replace( ".", "," );
        sizeNum = parseFloat( strSize );
      }
    }
    else if( strSize.indexOf(',') != -1  )
    {
      sizeNum = parseFloat( strSize );
      //might be the wrong decimal separation
      if( sizeNum == 0 || isNaN( sizeNum ) )
      {
        strSize = strSize.replace( ",", "." );
        sizeNum = parseFloat( strSize );
      }
    }
    else
    {
      sizeNum = parseInt( strSize, 10 );
    }
    width = width * sizeNum;
    height = height * sizeNum;
  }

  var doubleLines = false;
  var imagepath_has_resolution = (imagepath.indexOf("resolution=") >= 0);
  var imagepath_uses_2cif = (imagepath.indexOf("resolution=2CIFEXP") == -1 && imagepath.indexOf("resolution=2CIF") != -1);

  var streamprofile_has_resolution = false;
  var streamprofile_uses_2cif = false;
  if ((imagepath.indexOf("streamprofile=") != -1))
  {
    var videoFormat = document.getElementsByName("videoFormat")[0];
    if (videoFormat)
    {
      var streamprofile_nr = videoFormat.options[videoFormat.selectedIndex].value;
      var streamprofile_param = document.getElementsByName("root_StreamProfile_S" + streamprofile_nr + "_Parameters")[0];
      if (streamprofile_param)
      {
        streamprofile_has_resolution = (streamprofile_param.value.indexOf("resolution=") >= 0);
        streamprofile_uses_2cif = (streamprofile_param.value.indexOf("resolution=2CIFEXP") == -1 && streamprofile_param.value.indexOf("resolution=2CIF") != -1);
      }
    }
  }

  if (recording != "yes" && resolution_in_url == "" && streamprofile_in_url == "" && !imagepath_has_resolution && !streamprofile_has_resolution && resolution_in_parhand.toLowerCase() == "2cif"
      || imagepath_uses_2cif || streamprofile_uses_2cif)
  {
    doubleLines = true;
  }

  if (width > height)
  {
    height *= (doubleLines ? 2 : 1);
    if (isTilted)
    {
      var tmp = width;
      width = height;
      height = tmp;
    }
  }
  else
  {
    width *= (doubleLines ? 2 : 1);
  }
  resolution = width + 'x' + height;

  videoWidth = width;
  videoHeight = height;

  var width_height = 'width="' + width + '" height="' + height + '"';
  var viewer = "";

  if (viewer == "")
  {
    if (IEBrowser)
    {
      viewer = "activex";
    }
    else
    {
      viewer = "spush";
    }
  }

  if (viewer.indexOf("activex") != -1)
  {
    use_activex = 1;
  }
  if (viewer.indexOf("spush") != -1)
  {
    use_spush = 1;
  }
  if (viewer.indexOf("flash") != -1)
  {
    use_flash = 1;
  }
  if (viewer.indexOf("quicktime") != -1)
  {
    use_quicktime = 1;
  }
  if ((imagepath.indexOf("videocodec=mpeg4") != -1) || (imagepath.indexOf("videocodec=h264") != -1))
  {
    if (IEBrowser)
    {
        use_quicktime = 0;
        use_activex = 1;
    }
    else
    {
      use_quicktime = 1;
      use_spush = 0;
      use_still = 0;
    }
  }
  else
  {
    if (IEBrowser)
    {
        use_quicktime = 0;
        use_activex = 1;
    }
    else
    {
      use_quicktime = 0;
      use_spush = 1;
      use_still = 0;
    }
  }
  if (viewer.indexOf("java") != -1)
  {
    if ((imagepath.indexOf("mpeg4") == -1) && (imagepath.indexOf("h264") == -1))
    {
      use_java = 1;
      use_activex = 0;
      use_spush = 0;
      use_flash = 0;
      use_still = 0;
      use_quicktime = 0;
    }
  }
  if ((viewer.indexOf("still") != -1) || !(use_activex || use_spush || use_flash || use_java || use_quicktime))
  {
    if ((imagepath.indexOf("mpeg4") == -1) && (imagepath.indexOf("h264") == -1))
    {
      use_still = 1;
      use_quicktime = 0;
      use_spush = 0;
      use_activex = 0;
    }
    else
    {
      if (IEBrowser)
      {
        use_activex = 1;
      }
      else
      {
        use_quicktime = 1;
      }
    }
  }
  var agent = navigator.userAgent.toLowerCase();
  if (agent.indexOf("applewebkit/") != -1)
  {
    var pos = agent.indexOf("applewebkit/") + 12
    var webKitVersion = parseInt(agent.substring(pos, agent.indexOf(" ", pos)), 10)
    if ((use_spush) && (webKitVersion < 416))
    {
      use_java = 1;
      use_spush = 0;
    }
  }


  if (use_activex)
  {
    /* Width is index 0, height is index 1 */
    var control_offset = [0, 0];

    if (ShowAMCToolbar === "yes")
    {
      control_offset[1] = amcToolbarHeight;
    }

var prodName,
    notAuthorizedText,
    authorizedText,
    installDecoderText1,
    installDecoderText2;

prodName = "AXIS P1354 Network Camera"
    notAuthorizedText = langObjVideo.getText("notAutTxt")+" "+ prodName;
    authorizedText = langObjVideo.getText("autTxt");
    installDecoderText1 = langObjVideo.getText("instDecoderTxt");
    installDecoderText2 = langObjVideo.getText("instDecoder2Txt")+ " " +prodName+ " " +langObjVideo.getText("instDecoder2_3Txt");
    var notAuthorizedH264Text = langObjVideo.getText("notAutH264Txt")+ " " +prodName;
    var authorizedH264Text = langObjVideo.getText("autH264Txt");
    var installDecoderH264Text1 = langObjVideo.getText("instDecoder1H264Txt");
    var installDecoderH264Text2 = langObjVideo.getText("instDecoder2_1H264Txt")+" "+ prodName + " " +langObjVideo.getText("instDecoder2_2H264Txt");
    var notAuthorizedAacText = langObjVideo.getText("notAutAacTxt")+" "+prodName+ ".";
    var authorizedAacText = langObjVideo.getText("autAacTxt");
    var installAacDecoderText1 = langObjVideo.getText("instAacDecoder1Txt");
    var installAacDecoderText2 = langObjVideo.getText("instAacDecoder2Txt");

    installText1 = langObjVideo.getText("inst1Txt");
    installLangText1 = langObjVideo.getText("instLangTxt");
    videoText = langObjVideo.getText("vidTxt");
    audioText = langObjVideo.getText("audTxt");
    installText2 = langObjVideo.getText("inst2Txt");
    installText3 = langObjVideo.getText("inst3Txt");
    installText4 = langObjVideo.getText("inst4_1Txt")+prodName +" " +langObjVideo.getText("inst4_2Txt");
    installLangText2 = langObjVideo.getText("inst4_1Txt");
    document.write("<center>");
    DrawAMC("AXIS P1354", "AXIS Media Control", height+control_offset[1], width+control_offset[0], imagepath, "DE625294-70E6-45ED-B895-CFFA13AEB044", "AMC.cab", "7&#44;3&#44;10&#44;1", ShowAMCToolbar, "no", "no", "1", "no", "yes", "", "", "no", "554", "no", installText1, videoText, installText2, installText3, installText4, "0", (recording == "yes" ? "recording" : zoom_fact), "yes", "", minimap, amcLangCode);

      if (imagepath.indexOf("h264") != -1)
      {
        InstallDecoder("AXIS P1354", "H.264 Decoder", "7340F0E4-AEDA-47C6-8971-9DB314030BD7", "NotFound.cab", "5&#44;2&#44;0&#44;0", "yes", notAuthorizedH264Text, authorizedH264Text, installDecoderH264Text1, installDecoderH264Text2);
      }
        InstallFilter("AXIS P1354", "File Writer", "24E31783-87EF-4765-A430-4C8A983ACE16", "4&#44;2&#44;2&#44;0", "AMC.cab", installText1, videoText, installText2, installText3, installText4);
      if ( String( getHost(imagepath) ).indexOf("rtsp") != -1 )
      {
          InstallFilter("AXIS P1354", "Overlay Mixer Filter", "03825DEB-4BC8-4344-ACF7-EC390A8A5A21", "2&#44;7&#44;0&#44;0", "AMC.cab", installText1, videoText, installText2, installText3, installText4);
        InstallFilter("AXIS P1354", "MPEG RTP Reader", "67B1A88A-B5D2-48B1-BF93-EB74D6FCB077", "3&#44;4&#44;13&#44;6", "AMC.cab", installText1, videoText, installText2, installText3, installText4);
        InstallFilter("AXIS P1354", "Image Notify Component", "0173EEF5-1FDE-479C-9F24-34C3CB0B3243", "1&#44;2&#44;3&#44;0", "AMC.cab", installText1, videoText, installText2, installText3, installText4);
      } 

    installAllLanguages();

    document.write("</center>");
    document.write("<br>");

    var amcLangCode = langObjVideo.getLanguageCode("English", true);

    var oldonload = window.onload;
    var newonload = function() {
      if (oldonload) {
        oldonload();
      }
      var amc = document.Player;
      if (typeof amc != 'undefined') {
        if (amcLangCode != "") {
          amc.Language = amcLangCode;
        }
      }
    };
    window.onload = newonload;
  }

  if (use_spush)
  {
   if (recording != "yes" && ShowAMCToolbar == "yes")
   {
    document.write('<table cellspacing=0 cellpadding=0 border=0 style="min-width:260"><tr><td colspan="3" align="center">');
   }

  if (imagepath.indexOf("/axis-cgi/mjpg/video.cgi") != -1)
  {
    var searchStr = "/axis-cgi/mjpg/video.cgi"
    var replaceStr = "/jpg/image.jpg"
    var re = new RegExp(searchStr , "g")
    stillImagePath = imagepath.replace(re, replaceStr)
  }
  else
  {
    stillImagePath = "/axis-cgi/jpg/image.cgi?camera=1";
  }
  fullImagePath = imagepath;
    var output = '<img id="stream" src="" ' + width_height;
    var view_NoImageTxt = langObjVideo.getText("noImageTxt");
    output += ' border=0 ALT="' + view_NoImageTxt + '">';

  var oldonload = window.onload;
  var newonload;
  if( oldonload )
  {
    newonload = function() {
      oldonload();
      stopStartStream(fullImagePath);
    }
  }
  else
  {
    newonload = function() {
      stopStartStream(fullImagePath);
    }
  }
  window.onload = newonload;

    output += '<br>';
    document.write(output);
    if (recording != "yes" && ShowAMCToolbar == "yes")
    {
      document.write('</td></tr>');
      document.write('<tr><td colspan="3" align="center" style="white-space:nowrap">' );

        document.write('<div class="cornerVideoBox"><div class="content">');
        document.write('<table cellspacing=0 border=0 width="100%" id="videoItems" class="shownItems">');
        document.write('<tr height="32">');
        document.write("<td align=\"left\" width=\"40\"><a id=\"stopBtn\" href=\"javascript:void(0)\" onclick=\"stopStartStream('" + stillImagePath + "')\"><img src=\"/pics/stop_blue_button_27x27px.gif\" width=\"27\" height=\"27\" alt=\""+langObjVideo.getText("stoStrTxt")+"\" title=\""+langObjVideo.getText("stoStrTxt")+"\" border=\"0\" onmouseover=\"javascript:btnShiftCls( this, true )\" onmouseout=\"javascript:btnShiftCls( this, false )\" /></a>");
        document.write("<a id=\"playBtn\" style=\"display:none;\" href=\"javascript:void(0)\" onclick=\"stopStartStream('" + fullImagePath + "')\"><img src=\"/pics/play_blue_button_27x27px.gif\" width=\"27\" height=\"27\" alt=\""+langObjVideo.getText("staStrTxt")+"\" title=\""+langObjVideo.getText("staStrTxt")+"\" border=\"0\" onmouseover=\"javascript:btnShiftCls( this, true )\" onmouseout=\"javascript:btnShiftCls( this, false )\" /></a></td></tr></table>");

        document.write('</div><div class="footerLeft"><div class="footerRight"></div></div></div>');

         document.write('</td></tr></table>');
    }
  }

  if (use_quicktime)
  {
    var DisplayWidth = width;
    var DisplayHeight = height + (ShowAMCToolbar == "yes" ? 16 : 0 );
    var rtspPort = "554";
    if (imagepath.indexOf("://") == -1)
    {
      if (location.hostname.split(":").length > 1)
      {
        //IPv6
        var MediaURL = "rtsp://[" + location.hostname + "]:" + rtspPort + imagepath
      }
      else
      {
        //IPv4
        var MediaURL = "rtsp://" + location.hostname + ":" + rtspPort + imagepath
      }
    }
    else
    {
      var MediaURL = imagepath
    }

    var output = "";
    output  = '<OBJECT CLASSID="clsid:02BF25D5-8C17-4B23-BC80-D3488ABDDC6B" width=' + DisplayWidth + ' height=' + DisplayHeight + ' CODEBASE="http://www.apple.com/qtactivex/qtplugin.cab" id="QTPlayer">';
    output += '<param name="src" value="/view/AxisMoviePoster.mov">';
    output += '<param name="autoplay" value="true">';
    output += '<param name="controller" value="' + (ShowAMCToolbar == "yes" ? true : false) + '">';
    output += '<param name="qtsrc" value="' + MediaURL + '">';
    output += '<embed src="/view/AxisMoviePoster.mov" width=' + DisplayWidth + ' height=' + DisplayHeight + ' qtsrc="' + MediaURL + '" autoplay="true" controller="' + (ShowAMCToolbar == "yes" ? true : false) + '" target="myself" PLUGINSPAGE="http://www.apple.com/quicktime/download/"></embed>';
    output += '</OBJECT>';
    document.write(output);
  }

  if (use_flash)
  {
    var view_NeedFlashPluginTxt = langObjVideo.getText("needFlashPluginTxt");
    document.write('<EMBED src="/axis-cgi/mjpg/video.swf?resolution=' + resolution +'&camera=1" ' +
    'quality=high bgcolor=#000000 ' + width_height +
    ' TYPE="application/x-shockwave-flash" swLiveConnect=TRUE' +
    ' PLUGINSPAGE="http://www.macromedia.com/shockwave/download/index.cgi?P1_Prod_Version=ShockwaveFlash">' +
    '</EMBED>' +
     '<NOEMBED>' + view_NeedFlashPluginTxt +
    '<a href="http://www.macromedia.com/shockwave/download/">Macromedia</a>.' +
    '</NOEMBED><br>');
  }

  if (use_java)
  {
      if (resolution.indexOf("x") != 0 && isTilted)
      {
        var tmpW = parseInt(resolution.split("x")[0], 10);
        var tmpH = parseInt(resolution.split("x")[1], 10);
        if (tmpW < tmpH)
        {
          resolution = tmpH + "x" + tmpW;
        }
      }
    /* Width is index 0, height is index 1 */
    var control_offset = [0, 0];

     if (ShowAMCToolbar == "yes") {
      if (width < 300) {
        control_offset[0] += 300 - width;
        }
      control_offset[1] += 105;
     }

    var addr = "";
    if (imagepath.indexOf("http") != -1)
    {
      var addrEnd = imagepath.indexOf("/", 8);
      addr = imagepath;
    }
    //init AMA applet
    var amaStr = '<APPLET name="AMA" codeBase="/java/ama" archive="ama.jar" code="ama.MediaApplet" codetype="application/x-java-applet;version=1.4" type="application/x-java-applet;version=1.4" width="' + (width+control_offset[0]) + '" height="' + (height+control_offset[1]) + '" id="AMAPlayer">'
      + '<PARAM NAME="permissions" VALUE="sandbox">'
      + '<PARAM NAME="name" VALUE="AMA">'
      + '<PARAM NAME="codebase" VALUE="/java/ama">'
      + '<PARAM NAME="archive" VALUE="ama.jar">'
      + '<PARAM NAME="code" VALUE="ama.MediaApplet">'
      + '<PARAM NAME="codetype" VALUE="application/x-java-applet;version=1.4">'
      + '<PARAM NAME="type" VALUE="application/x-java-applet;version=1.4">'
      + '<PARAM NAME="mayscript" VALUE="false">'
      + '<PARAM NAME="ama_cgi-path" VALUE="axis-cgi">'
      + '<PARAM NAME="cache_archive" VALUE="ama.jar">'
      + '<PARAM NAME="cache_version" VALUE="1.2.0.0">'
      + '<PARAM NAME="ama_plugins" VALUE="">';
  var img_opts = "";
  if (imagepath.indexOf("?") > 0)
  {
    img_opts = imagepath.substring(imagepath.indexOf("?"));
    imagepath = imagepath.substring(0, imagepath.indexOf("?"));
  }
  if (img_opts.indexOf("camera=") == -1)
    img_opts += (img_opts.length > 0 ? "&" : "?") + "camera=1";

    if (img_opts.indexOf("resolution=") == -1)
      img_opts += (img_opts.length > 0 ? "&" : "?") + "resolution=" + resolution;

  if (rotation_in_parhand != "" && img_opts.indexOf("rotation=") == -1)
    img_opts += (img_opts.length > 0 ? "&" : "?") + "rotation=" + rotation_in_parhand;

  amaStr += '<PARAM NAME="ama_url" VALUE="' + imagepath + img_opts + '">';
    amaStr += langObjVideo.getText("yoBrDoNoSuJaTxt");
    amaStr += '</APPLET><br>';
    document.write(amaStr);
  }

  if (use_still)
  {
    var picturepath;
    var tmpAddress = imagepath.match(/\/\/(.+?)\//g);
    var cameranbr = "1";

    if (tmpAddress == null)
      tmpAddress = imagepath.match(/(.+?)\//g);

    if (imagepath.charAt(0) == '/' || tmpAddress == null)
      picturepath = "/jpg/image.jpg";
    else
      picturepath = document.location.protocol + "//" + tmpAddress + "/jpg/image.jpg";

    picturepath += "?camera="+cameranbr; 

    document.write('<img id="stream" src="' + picturepath + '" border=0 ' + width_height +'><br>');
  }

  if (!isJavaSupported()) {
    $('object').replaceWith(langObjVideo.getText("noNPAPISupport"));
    $("#AMAPlayer").replaceWith("<div style='text-align: center'>" + langObjVideo.getText("noNPAPISupport") + "</div>");
  }
}

function stopStartStream(path)
{
  try {
    var orgPath = path;
    theDate = new Date();
    if (path.indexOf("?") != -1)
      path += "&"
    else
      path += "?"
    path += "timestamp=" + theDate.getTime()
    if (use_spush) {
      if (recording != "yes")
        stopStartBtnShift( orgPath );
      document.getElementById("stream").src = path;
    } else if (use_activex) {
      document.Player.MediaURL = path;
    }
  }
  catch(e) {}
}


function stopStartBtnShift( orgPath )
{
  try {
    if( orgPath == stillImagePath ) {
      document.getElementById("stopBtn").style.display = 'none';
      document.getElementById("playBtn").style.display = 'inline';
    } else {
      document.getElementById("stopBtn").style.display = 'inline';
      document.getElementById("playBtn").style.display = 'none';
    }
  }
  catch(e) {}
}

function btnShiftCls( btnEl, over )
{
  if( btnEl ){
    btnEl.className = ((over)?'hover':'');
  }
}

var debounce = typeof _ !== "undefined" ? _.debounce : function(func) {
  return function() {
    return func.apply(func, arguments);
  };
};
var hasCustomEventUtil = typeof AXIS !== "undefined" && typeof AXIS.CustomEventUtil !== "undefined";
var debouncedResizeInitiatedTrigger = hasCustomEventUtil ? debounce(function() {
  AXIS.CustomEventUtil.publish("resize:initiated");
}, 100, true) : function() {};
var debouncedResizeCompletedTrigger = hasCustomEventUtil ? debounce(function() {
  AXIS.CustomEventUtil.publish("resize:completed");
}, 100) : function() {};


var globalAutoScale = true,
    minMarginSize = new objectSize(0, 0),
    originalStreamSize;
function dynamicResize(autoscale) {
  if (isNaN(videoWidth) || isNaN(videoHeight) || (videoWidth <= 800 && videoHeight <= 600) || (videoWidth <= 600 && videoHeight <= 800))
    return;

  debouncedResizeInitiatedTrigger();

  if (typeof autoscale == 'undefined')
    autoscale = globalAutoScale;
  else
    globalAutoScale = autoscale;

  var browserSize = getBrowserSize(),
      documentSize = getDocumentSize(),
      adjustBtn = document.getElementById("adjustSize"),
      fullSizeBtn = document.getElementById("fullSize"),
      toolbarHeight = 0,
      streamObj;

  if (use_spush) {
    streamObj = document.getElementById("stream");
  } else if (use_activex) {
    streamObj = document.Player;
    toolbarHeight = ((ShowAMCToolbar == "yes") ? amcToolbarHeight : 0);
  } else if (use_still) {
    streamObj = document.getElementById("stream");
  } else if (use_quicktime || use_java || use_flash) {
    return;
  }

  if( streamObj === null || typeof streamObj === "undefined" || streamObj === '') {
    return;
  }
  if (!originalStreamSize)
    originalStreamSize = new objectSize(parseInt(streamObj.width, 10), parseInt(streamObj.height, 10));

  if (autoscale) {
    if ((minMarginSize.width === 0 && minMarginSize.height === 0) &&
        (browserSize.width === documentSize.width && browserSize.height === documentSize.height)) {
      minMarginSize.width = browserSize.width-parseInt(streamObj.width, 10);
      minMarginSize.height = browserSize.height-parseInt(streamObj.height, 10);
    } else {
      if (minMarginSize.width === 0 &&  browserSize.width < documentSize.width)
        minMarginSize.width = documentSize.width-originalStreamSize.width;

      if (minMarginSize.height === 0 &&  browserSize.height < documentSize.height)
        minMarginSize.height = documentSize.height-originalStreamSize.height;
    }

    if (browserSize.width <= documentSize.width || browserSize.height <= documentSize.height) {
      var ratio, maxSize, newWidth, newHeight;

      ratio = videoWidth/videoHeight;
      maxSize = new objectSize(browserSize.width-minMarginSize.width, browserSize.height-minMarginSize.height);

      newWidth = maxSize.width;
      newHeight = newWidth/ratio+toolbarHeight;

      if (newHeight > maxSize.height) {
        newHeight = maxSize.height;
        newWidth = (newHeight-toolbarHeight)*ratio;
      }

      if (newWidth <= 640) {
        newWidth = 640;
        newHeight = newWidth/ratio+toolbarHeight;
      }

      streamObj.width = Math.round( newWidth );
      streamObj.height = Math.round( newHeight );
    }

    adjustBtn.src = "/pics/button_downsize_gray_27x27px.gif";
    fullSizeBtn.src = "/pics/button_x1_27x27px.gif";
  } else {
    var currentStreamSize = new objectSize(parseInt(streamObj.width, 10), parseInt(streamObj.height, 10));

    streamObj.width = videoWidth;
    streamObj.height = videoHeight + toolbarHeight;

    if (currentStreamSize.width > videoWidth || currentStreamSize.height > videoHeight) {
      streamObj.width = currentStreamSize.width;
      streamObj.height = currentStreamSize.height;
    }

    adjustBtn.src = "/pics/button_downsize_27x27px.gif";
    fullSizeBtn.src = "/pics/button_x1_gray_27x27px.gif";
  }

  debouncedResizeCompletedTrigger();
}

function objectSize(w, h) {
  this.width = w;
  this.height = h;
}

function getBrowserSize() {
  var browserSize = new objectSize(0, 0);

  browserSize.width = parseInt(window.innerWidth, 10) || parseInt(document.documentElement.clientWidth, 10);
  browserSize.height = parseInt(window.innerHeight, 10) || parseInt(document.documentElement.clientHeight, 10);

  return browserSize;
}

function getDocumentSize() {
  var doc, docSize = new objectSize(0, 0);

  if (parent.frames[0] == undefined) {
    doc = document;
  } else if (parent.frames[0].parent.frames[0] == undefined) {
    doc = parent.frames[0].document
  } else {
    doc = parent.frames[0].parent.frames[0].document;
  }

  if (doc.body.scrollWidth)
    docSize.width = Math.max(parseInt(doc.documentElement.scrollWidth, 10), parseInt(doc.body.scrollWidth, 10));

  if (doc.body.scrollHeight)
    docSize.height = Math.max(parseInt(doc.documentElement.scrollHeight, 10), parseInt(doc.body.scrollHeight, 10));

  return docSize;
}

function installAllLanguages()
{
  InstallLanguage("AXIS P1354", "Brazilian Portuguese for AMC", "CE9ED303-6C46-42b0-A7C6-176524B0BCC5", "6&#44;3&#44;6&#44;0", "AMC.cab", installLangText1, installText2, installText3, installLangText2);
  InstallLanguage("AXIS P1354", "Chinese for AMC", "1A2AB117-83C8-4a1e-B540-A9AF97877C4D", "6&#44;3&#44;12&#44;5", "AMC.cab", installLangText1, installText2, installText3, installLangText2);
  InstallLanguage("AXIS P1354", "French for AMC", "3F49AC06-5656-42e3-B3D7-8B10463C8AD7", "6&#44;3&#44;6&#44;0", "AMC.cab", installLangText1, installText2, installText3, installLangText2);
  InstallLanguage("AXIS P1354", "German for AMC", "4F6451EA-6721-46e2-BED0-20A35F35586E", "6&#44;3&#44;6&#44;0", "AMC.cab", installLangText1, installText2, installText3, installLangText2);
  InstallLanguage("AXIS P1354", "Italian for AMC", "FF53C365-BD40-43e0-80A8-2A878BF3FE30", "6&#44;3&#44;6&#44;0", "AMC.cab", installLangText1, installText2, installText3, installLangText2);
  InstallLanguage("AXIS P1354", "Japanese for AMC", "B64CEEAD-A2EC-4374-8235-BB55253E923D", "6&#44;3&#44;6&#44;0", "AMC.cab", installLangText1, installText2, installText3, installLangText2);
  InstallLanguage("AXIS P1354", "Spanish for AMC", "BB257547-E2C4-48f5-9EA5-096DC31DB9D5", "6&#44;3&#44;6&#44;0", "AMC.cab", installLangText1, installText2, installText3, installLangText2);
  InstallLanguage("AXIS P1354", "Korean for AMC", "63A4C84A-349B-4B0B-A266-8EE369E7FE04", "6&#44;3&#44;6&#44;0", "AMC.cab", installLangText1, installText2, installText3, installLangText2);
  InstallLanguage("AXIS P1354", "Russian for AMC", "F767219C-8768-41C7-850A-D9BB5BFF53EE", "6&#44;3&#44;6&#44;0", "AMC.cab", installLangText1, installText2, installText3, installLangText2);
}

function goto_camera(cam)
{
  cam += ''; // cam value needs to be a string, not an integer, for cam.length to work.
  cam = '';

  newVideoFormatCam(cam);
}

function getStreamProfileNbr()
{
  var videoFormat = "MJPEG";
  var oVideoFormat = document.WizardForm.videoFormat;
  if( oVideoFormat && oVideoFormat.selectedIndex >= 0 )
  {
    videoFormat = oVideoFormat.options[ oVideoFormat.selectedIndex ].value;
  }
  return videoFormat;
}

function getStreamProfileName()
{
  try {
    var nbr = getStreamProfileNbr();
    return ( isNaN( nbr )?"":document.profileForm["root_StreamProfile_S" + nbr + "_Name"].value );
  }
  catch(e) {
    alert( langObjView.getText("proNoVaAlrt") );
  }
}

function getStreamProfileParameters()
{
  try {
    var nbr = getStreamProfileNbr();
    return ( isNaN( nbr )?"":document.profileForm["root_StreamProfile_S" + nbr + "_Parameters"].value );
  }
  catch(e) {
    alert( langObjView.getText("proNoVaAlrt") );
  }
}
// -->
</script><!-- $camnbr = quad --><!-- $external = no -->

<script src="/incl/activeX.js?id=8453"></script>

<script language="JavaScript">

  var videoConfiguredCorrectly = true;

  if (typeof AXIS !== "undefined" && typeof AXIS.CustomEventUtil !== "undefined") {
    AXIS.CustomEventUtil.once("video:unsupportedResolution", function() {
      videoConfiguredCorrectly = false;
    });
  }

  function bodyOnLoad() {

    langObjView.init();

    if (!videoConfiguredCorrectly) {
      var resolutionHint = document.createElement("div");
      resolutionHint.className = "hint";

      var resolutionHintHeader = document.createElement("div");
      resolutionHintHeader.className = "header";
      resolutionHintHeader.innerHTML = langObjView.getText("unsupportedResolutionTxt");

      resolutionHint.appendChild(resolutionHintHeader);

      var resolutionHintExplanation = document.createElement("p");
      resolutionHintExplanation.innerHTML = langObjView.getText("unsupportedResolutionHintTxt");

      resolutionHint.appendChild(resolutionHintExplanation);

      document.querySelector("#streamPlaceholder").appendChild(resolutionHint);
    }
    else {
      DrawTB('no',
        decodeEncodingJavascript('/mjpg/video.mjpg'),
        '1',
        '0',
        'no',
        'no',
        'true', getStreamProfileNbr());
      dynamicResize();
    }

      requestPTZPresets(updatePresetNames);

    drawTriggerButtons();



  }

  function bodyOnResize() {
    if (!videoConfiguredCorrectly) {
      return;
    }

    dynamicResize();



  }
</script>
</head>


<body class="bodyBg" topmargin="0" leftmargin="15" marginwidth="0" marginheight="0" onload="bodyOnLoad();" onresize="bodyOnResize();">
<script language="JavaScript">
<!--
  var t1;
  var seqOn = "no";

function sequence()
{
  var size;
  if (seqOn == 'no') {
    seqOn = 'yes';
    size = 1;
    doSequence(size);
  } else {
    clearTimeout(t1);
    seqOn = 'no';
    link = document.URL;
    if (link.indexOf('seq=yes' != -1)) {
      var regexp = /seq=yes&/;
      link = link.replace(regexp, "");
    }
    document.location = link;
  }
  return;
}

// -->
</script>




<form name="profileForm"><input type="hidden" name="root_StreamProfile_MaxGroups" value="26"><input type="hidden" name="root_StreamProfile_S0_Description" value="Best image quality and full frame rate."><input type="hidden" name="root_StreamProfile_S0_Name" value="Quality"><input type="hidden" name="root_StreamProfile_S0_Parameters" value="videocodec=h264&amp;resolution=1280x960&amp;compression=20&amp;fps=0&amp;videokeyframeinterval=8&amp;videobitrate=0&amp;h264profile=main"><input type="hidden" name="root_StreamProfile_S1_Description" value="Medium image quality and frame rate."><input type="hidden" name="root_StreamProfile_S1_Name" value="Balanced"><input type="hidden" name="root_StreamProfile_S1_Parameters" value="videocodec=h264&amp;resolution=1280x960&amp;compression=30&amp;fps=15&amp;videokeyframeinterval=15&amp;videobitrate=0&amp;h264profile=main"><input type="hidden" name="root_StreamProfile_S2_Description" value="Low bandwidth with medium image quality."><input type="hidden" name="root_StreamProfile_S2_Name" value="Bandwidth"><input type="hidden" name="root_StreamProfile_S2_Parameters" value="videocodec=h264&amp;resolution=1280x720&amp;compression=50&amp;fps=15&amp;videokeyframeinterval=32&amp;videobitrate=250&amp;videomaxbitrate=1000&amp;videobitratepriority=framerate&amp;h264profile=main"><input type="hidden" name="root_StreamProfile_S3_Description" value="Mobile device settings."><input type="hidden" name="root_StreamProfile_S3_Name" value="Mobile"><input type="hidden" name="root_StreamProfile_S3_Parameters" value="videocodec=h264&amp;resolution=160x90&amp;compression=50&amp;fps=15&amp;videokeyframeinterval=32&amp;videobitrate=120&amp;videomaxbitrate=128&amp;videobitratepriority=quality&amp;audio=0&amp;h264profile=baseline">
</form>
<form name="listFormInt"><input type="hidden" name="root_ImageSource_NbrOfSources" value="1"><input type="hidden" name="root_ImageSource_I0_Name" value="Camera"><input type="hidden" name="root_ImageSource_I0_Focus_Mode" value="fixed"><input type="hidden" name="root_ImageSource_I0_Focus_NearLimit" value="0"><input type="hidden" name="root_ImageSource_I0_Focus_Pos" value="0.5392950177192688"><input type="hidden" name="root_ImageSource_I0_Focus_TemperatureCorrection" value="on"><input type="hidden" name="root_ImageSource_I0_Focus_Window_W0" value="0.15,0.15:0.85,0.15:0.85,0.85:0.15,0.85"><input type="hidden" name="root_ImageSource_I0_Sensor_AspectRatio" value="4:3">
</form>

<form name="listFormCrop">
  <input type="hidden" name="root_Image_I0_Name" id="root_Image_I0_Name" value="View Area 1">
  <input type="hidden" name="root_Image_I0_Enabled" id="root_Image_I0_Enabled" value="yes">
  <input type="hidden" name="root_PTZ_Various_V1_Locked" id="root_PTZ_Various_V1_Locked" value="true">
</form>

<form name="listFormExt">
</form>

<script language="JavaScript">
<!--

// Calculate the number of external sources that are supported by this browser
var ext_sources = 0;
ext_sources = document.listFormExt.elements.length/3;
// -->
</script>

<form name="listFormPreset"><input type="hidden" name="root_PTZ_Preset_P0_ImageSource" value="0"><input type="hidden" name="root_PTZ_Preset_P0_HomePosition" value="1"><input type="hidden" name="root_PTZ_Preset_P0_Position_P1_Data" value="tilt=0.000000:pan=0.000000:zoom=1.000000"><input type="hidden" name="root_PTZ_Preset_P0_Position_P1_Name" value="Home">
</form>

<form name="listFormSeq">
</form>

<script language="JavaScript">
<!--

// Calculate the number of sequence sources that are supported by this browser
var seq_sources = 0;
if (document.listFormSeq.elements.length > 0 )  {
  if (browser == "IE") {
    seq_sources = document.listFormSeq['root_Sequence_S0_NbrOfSources'].value;
  } else {
    for (var i = 0; i < document.listFormSeq['root_Sequence_S0_NbrOfSources'].value; i++) {
      var type = document.listFormSeq['root_Sequence_S0_Source_S' + i + '_Type'].value;
      if (type != 'Ext') {
        seq_sources++;
      } else {
        var num = document.listFormSeq['root_Sequence_S0_Source_S' + i + '_Number'].value;
        var path = document.listFormExt['root_ExternalVideo_E' + num + '_ImagePath'].value;
        if ((path.indexOf("mpeg4") == -1) || (path.indexOf("h264") == -1)) {
          seq_sources++;
        }
      }
    }
  }
}
// -->
</script>

<form name="outputsForm"><input type="hidden" name="root_IOPort_I0_Direction" value="input"><input type="hidden" name="root_IOPort_I1_Direction" value="output"><input type="hidden" name="root_IOPort_I1_Output_Active" value="closed"><input type="hidden" name="root_IOPort_I1_Output_Button" value="none"><input type="hidden" name="root_IOPort_I1_Output_DelayTime" value="0"><input type="hidden" name="root_IOPort_I1_Output_Mode" value="bistable"><input type="hidden" name="root_IOPort_I1_Output_Name" value="Output 1"><input type="hidden" name="root_IOPort_I1_Output_PulseTime" value="0">
</form>


  <form name="UploadedFilesForm">
  </form>

<table width="100%" cellspacing="0" cellpadding="0" border="0"><tbody><tr><td align="center">
<form name="WizardForm" method="post">
    <input type="hidden" name="root_Layout_Trigger_T0_Enabled" value="no">

  <input type="hidden" name="amount" value="0">

  <br>
  <table width="778" cellspacing="0" cellpadding="0" border="0">
    <tbody><tr class="top-mainborder">
      <td colspan="2"><img src="/pics/line_corner_lt_5x5px.gif" width="5" height="5" border="0" alt=""></td>
      <td background="/pics/line_t_100x5px.gif"><img src="/pics/line_t_100x5px.gif" width="768" height="5" border="0" alt=""></td>
      <td colspan="2"><img src="/pics/line_corner_rt_5x5px.gif" width="5" height="5" border="0" alt=""></td>
    </tr>
    <tr>
      <td class="lineBg"><img src="/pics/blank.gif" width="1" border="0" alt=""></td>
      <td><img src="/pics/blank.gif" width="4" height="1" border="0" alt=""></td>
      <td valign="middle" align="left" width="100%">
        <table border="0" cellspacing="0" cellpadding="0" width="100%">
          <tbody><tr>
          <td>
  <script language="JavaScript" type="text/javascript">
  <!--
    for (i=0; i<document.UploadedFilesForm.length; i++) {
      if (document.UploadedFilesForm.elements[i].value.indexOf("viewer/extraLogo_left.") != -1) {
        document.write('<img src="/local/'+document.UploadedFilesForm.elements[i].value+'">&nbsp;');
        break;
      }
    }
  -->
  </script>
          <a href="http://www.axis.com/" target="_blank"><img src="/pics/logo_70x29px.gif" width="68" height="29" border="0" title="Axis" alt="Axis"></a>
  <script language="JavaScript" type="text/javascript">
  <!--
    for (i=0; i<document.UploadedFilesForm.length; i++) {
      if (document.UploadedFilesForm.elements[i].value.indexOf("viewer/extraLogo_right.") != -1) {
        document.write('&nbsp;<img src="/local/'+document.UploadedFilesForm.elements[i].value+'">');
        break;
      }
    }
  -->
  </script>
        </td>
            <td class="topTitle" align="center" id="view_prodName" nowrap="">AXIS P1354 Network Camera</td>
            <td align="right" nowrap="">
              <table cellpadding="0" cellspacing="5" border="0">
                <tbody><tr>
                  <td nowrap=""><a href="/index.shtml" target="_top" class="linkActive" id="view_LViewTxt">Live View</a></td><td>|</td>
                  <td><a href="/operator/basic.shtml?id=8453" class="linkInActive" target="_top" id="view_SetTxt1">Setup</a></td><td>|</td>
                  <td><a href="#" onclick="javascript:launch('/help/liveview_h.shtml?cntrlQue=no'); return false;" class="linkInActive" id="view_HelpTxt">Help</a></td>
                </tr>
              </tbody></table>
            </td>
          </tr>
        </tbody></table>
      </td>

      <td><img src="/pics/blank.gif" width="4" border="0" alt=""></td>
      <td class="lineBg"><img src="/pics/blank.gif" width="1" height="1" alt=""></td>
    </tr>
    <tr>
      <td class="lineBg"><img src="/pics/blank.gif" width="1" height="5" alt=""></td>
      <td colspan="3"><img src="/pics/blank.gif" width="1" height="5" alt=""></td>
      <td class="lineBg"><img src="/pics/blank.gif" width="1" height="5" alt=""></td>
    </tr>
    <tr class="bottom-mainborder">
      <td colspan="2"><img src="/pics/line_corner_lb_5x5px.gif" width="5" height="5" alt=""></td>
      <td background="/pics/line_b_100x5px.gif"><img src="/pics/blank.gif" width="768" height="5" alt=""></td>
      <td colspan="2"><img src="/pics/line_corner_rb_5x5px.gif" width="5" height="5" alt=""></td>
    </tr>
    <tr>
      <td colspan="5"><img src="/pics/blank.gif" width="1" height="5" border="0" alt=""></td>
    </tr>

    <tr>
      <td colspan="5">
        <table width="100%" cellpadding="0" cellspacing="0" border="0">
          <tbody>
          <tr id="appendableTr">
          <td><table cellpadding="0" cellspacing="0" style="width: 100%; height: 46px; border: 0px;"><tbody><tr class="top-mainborder"><td colspan="2" style="width: 5px; background-image: url(&quot;/pics/gray_corner_lt_5x50px.gif&quot;);"><img src="/pics/blank.gif" style="width: 5px; height: 5px; border: 0px;"></td><td valign="top" align="center" class="funcText" style="width: 100%; height: 5px; white-space: nowrap; background-image: url(&quot;/pics/gray_t_5x50px.gif&quot;);">View size</td><td colspan="2" style="width: 5px; background-image: url(&quot;/pics/gray_corner_rt_5x50px.gif&quot;);"><img src="/pics/blank.gif" style="width: 5px; height: 5px; border: 0px;"></td></tr><tr><td class="lineBg" style="width: 1px;"><img src="/pics/blank.gif" style="width: 1px; height: 5px; border: 0px;"></td><td style="width: 4px;"><img src="/pics/blank.gif" style="width: 4px; height: 5px; border: 0px;"></td><td valign="middle" align="center" style="width: 100%;"><table cellpadding="0" cellspacing="0" style="border: 0px;"><tbody><tr><td valign="middle" align="left"><a href="JavaScript:dynamicResize(true)" target="_self"><img src="/pics/button_downsize_gray_27x27px.gif" border="0" id="adjustSize" alt="Adjust to the browser size" title="Adjust to the browser size" style="width: 27px; height: 27px;"></a></td><td valign="middle" align="left"><a href="JavaScript:dynamicResize(false)" target="_self"><img src="/pics/button_x1_27x27px.gif" border="0" id="fullSize" alt="Full image" title="Full image" style="width: 27px; height: 27px;"></a></td></tr></tbody></table></td><td style="width: 4px;"><img src="/pics/blank.gif" style="width: 4px; height: 5px; border: 0px;"></td><td class="lineBg" style="width: 1px;"><img src="/pics/blank.gif" style="width: 1px; height: 5px; border: 0px;"></td></tr><tr class="bottom-mainborder"><td colspan="2" style="width: 5px; background-image: url(&quot;/pics/line_corner_lb_5x5px.gif&quot;);"><img src="/pics/blank.gif" style="width: 5px; height: 5px; border: 0px;"></td><td style="width: 100%; height: 5px; background-image: url(&quot;/pics/line_b_100x5px.gif&quot;);"><img src="/pics/blank.gif" style="width: 1px; height: 5px; border: 0px;"></td><td colspan="2" style="width: 5px; height: 5px; background-image: url(&quot;/pics/line_corner_rb_5x5px.gif&quot;);"><img src="/pics/blank.gif" style="width: 5px; height: 5px; border: 0px;"></td></tr></tbody></table></td><td style="width: 5px;"><img src="/pics/blank.gif" style="width: 5px; height: 5px; border: 0px;"></td><td><table cellpadding="0" cellspacing="0" style="width: 100%; height: 46px; border: 0px;"><tbody><tr class="top-mainborder"><td colspan="2" style="width: 5px; background-image: url(&quot;/pics/gray_corner_lt_5x50px.gif&quot;);"><img src="/pics/blank.gif" style="width: 5px; height: 5px; border: 0px;"></td><td valign="top" align="center" class="funcText" style="width: 100%; height: 5px; white-space: nowrap; background-image: url(&quot;/pics/gray_t_5x50px.gif&quot;);">Stream profile</td><td colspan="2" style="width: 5px; background-image: url(&quot;/pics/gray_corner_rt_5x50px.gif&quot;);"><img src="/pics/blank.gif" style="width: 5px; height: 5px; border: 0px;"></td></tr><tr><td class="lineBg" style="width: 1px;"><img src="/pics/blank.gif" style="width: 1px; height: 5px; border: 0px;"></td><td style="width: 4px;"><img src="/pics/blank.gif" style="width: 4px; height: 5px; border: 0px;"></td><td valign="middle" align="center" style="width: 100%;"><table cellpadding="0" cellspacing="0" style="border: 0px;"><tbody><tr><td valign="middle" align="left"><select name="videoFormat" id="videoFormat"><option value="MJPEG">Motion JPEG</option><option value="H264">H.264</option><option value="hdtv">HDTV</option><option value="0">Quality</option><option value="1">Balanced</option><option value="2">Bandwidth</option><option value="3">Mobile</option></select></td></tr></tbody></table></td><td style="width: 4px;"><img src="/pics/blank.gif" style="width: 4px; height: 5px; border: 0px;"></td><td class="lineBg" style="width: 1px;"><img src="/pics/blank.gif" style="width: 1px; height: 5px; border: 0px;"></td></tr><tr class="bottom-mainborder"><td colspan="2" style="width: 5px; background-image: url(&quot;/pics/line_corner_lb_5x5px.gif&quot;);"><img src="/pics/blank.gif" style="width: 5px; height: 5px; border: 0px;"></td><td style="width: 100%; height: 5px; background-image: url(&quot;/pics/line_b_100x5px.gif&quot;);"><img src="/pics/blank.gif" style="width: 1px; height: 5px; border: 0px;"></td><td colspan="2" style="width: 5px; height: 5px; background-image: url(&quot;/pics/line_corner_rb_5x5px.gif&quot;);"><img src="/pics/blank.gif" style="width: 5px; height: 5px; border: 0px;"></td></tr></tbody></table></td><td style="width: 5px;"><img src="/pics/blank.gif" style="width: 5px; height: 5px; border: 0px;"></td><td style="width: 100%;"><table cellpadding="0" cellspacing="0" style="width: 100%; height: 46px; border: 0px;"><tbody><tr class="top-mainborder"><td colspan="2" style="width: 5px; background-image: url(&quot;/pics/gray_corner_lt_5x50px.gif&quot;);"><img src="/pics/blank.gif" style="width: 5px; height: 5px; border: 0px;"></td><td valign="top" align="center" class="funcText" style="width: 100%; height: 5px; white-space: nowrap; background-image: url(&quot;/pics/gray_t_5x50px.gif&quot;);"><br></td><td colspan="2" style="width: 5px; background-image: url(&quot;/pics/gray_corner_rt_5x50px.gif&quot;);"><img src="/pics/blank.gif" style="width: 5px; height: 5px; border: 0px;"></td></tr><tr><td class="lineBg" style="width: 1px;"><img src="/pics/blank.gif" style="width: 1px; height: 5px; border: 0px;"></td><td style="width: 4px;"><img src="/pics/blank.gif" style="width: 4px; height: 5px; border: 0px;"></td><td valign="middle" align="center" style="width: 100%;"><table cellpadding="0" cellspacing="0" style="border: 0px;"><tbody><tr><td valign="middle" align="left"><img src="/pics/space.gif" border="0" style="width: 1px; height: 27px;"></td><td valign="middle" align="left" id="undefined"><br></td></tr></tbody></table></td><td style="width: 4px;"><img src="/pics/blank.gif" style="width: 4px; height: 5px; border: 0px;"></td><td class="lineBg" style="width: 1px;"><img src="/pics/blank.gif" style="width: 1px; height: 5px; border: 0px;"></td></tr><tr class="bottom-mainborder"><td colspan="2" style="width: 5px; background-image: url(&quot;/pics/line_corner_lb_5x5px.gif&quot;);"><img src="/pics/blank.gif" style="width: 5px; height: 5px; border: 0px;"></td><td style="width: 100%; height: 5px; background-image: url(&quot;/pics/line_b_100x5px.gif&quot;);"><img src="/pics/blank.gif" style="width: 1px; height: 5px; border: 0px;"></td><td colspan="2" style="width: 5px; height: 5px; background-image: url(&quot;/pics/line_corner_rb_5x5px.gif&quot;);"><img src="/pics/blank.gif" style="width: 5px; height: 5px; border: 0px;"></td></tr></tbody></table></td></tr>
          </tbody>
        </table>
      </td>
    </tr>

    <tr>
      <td colspan="5"><img src="/pics/blank.gif" width="1" height="5" border="0" alt=""></td>
    </tr>
    <tr class="top-mainborder">
      <td colspan="2"><img src="/pics/line_corner_lt_5x5px.gif" width="5" height="5" border="0" alt=""></td>
      <td background="/pics/line_t_100x5px.gif"><img src="/pics/blank.gif" width="768" height="5" border="0" alt=""></td>
      <td colspan="2"><img src="/pics/line_corner_rt_5x5px.gif" width="5" height="5" border="0" alt=""></td>
    </tr>

    <tr>
      <td width="1" class="lineBg"><img src="/pics/blank.gif" width="1" height="1" border="0" alt=""></td>
      <td width="4"><img src="/pics/blank.gif" width="4" height="1" border="0" alt=""></td>
      <td valign="top" align="center" width="768">

      <table border="0" cellpadding="0" cellspacing="0" height="100%" width="776">
          <tbody><tr height="197">
            <td valign="top"></td>
            <td valign="top" class="normalText" align="center" rowspan="2" colspan="2">
              <div id="filterinstallocation"></div>
            </td>
            <td align="center" class="normalText">
              <table border="0" cellpadding="3" cellspacing="3">
                <tbody><tr>
                  <td>

                    <script language="JavaScript">
                    <!--
                      var newimagepath = "/mjpg/video.mjpg";
                      var properties_audio_enabled = "yes";
                      var audiochannel_enabled = "no";
                      var audiosource = "0";
                      var audiosupport = "yes";
                      var videoformat = "mjpeg+";
                      var streamProfAudio = "";
                      var streamProfUseAudio = (streamProfAudio == "no")?false:true;

                      if (newimagepath.indexOf('http://') !== -1 || newimagepath.indexOf('https://') !== -1 || newimagepath.indexOf('script') !== -1) {
                        var cameraNbr;

                          cameraNbr = 1
                          newimagepath = '/mjpg/video.mjpg';
                      }

                      if (properties_audio_enabled == "yes" && audiochannel_enabled == "yes" && audiosupport == "yes" && (videoformat == "h264+" || videoformat == "mpeg4+") && streamProfUseAudio)
                      {
                        newimagepath += "&audiochannel=" + (parseInt(audiosource, 10) + 1);
                      }
                      video(newimagepath);
                    // -->
                    </script><table cellspacing="0" cellpadding="0" border="0" style="min-width:260"><tbody><tr><td colspan="3" align="center"><img id="stream" src="/mjpg/video.mjpg?timestamp=1727664612264" width="640" height="480" border="0" alt="If no image is displayed, there might be too many viewers, or the browser configuration may have to be changed. See help for detailed instructions on how to do this."><br></td></tr><tr><td colspan="3" align="center" style="white-space:nowrap"><div class="cornerVideoBox"><div class="content"><table cellspacing="0" border="0" width="100%" id="videoItems" class="shownItems"><tbody><tr height="32"><td align="left" width="40"><a id="stopBtn" href="javascript:void(0)" onclick="stopStartStream('/axis-cgi/jpg/image.cgi?camera=1')" style="display: inline;"><img src="/pics/stop_blue_button_27x27px.gif" width="27" height="27" alt="Stop stream" title="Stop stream" border="0" onmouseover="javascript:btnShiftCls( this, true )" onmouseout="javascript:btnShiftCls( this, false )"></a><a id="playBtn" style="display:none;" href="javascript:void(0)" onclick="stopStartStream('/mjpg/video.mjpg')"><img src="/pics/play_blue_button_27x27px.gif" width="27" height="27" alt="Start stream" title="Start stream" border="0" onmouseover="javascript:btnShiftCls( this, true )" onmouseout="javascript:btnShiftCls( this, false )"></a></td></tr></tbody></table></div><div class="footerLeft"><div class="footerRight"></div></div></div></td></tr></tbody></table>
                  </td>
                </tr>
              </tbody></table>
            </td>
          </tr>
            
          
        </tbody></table>



<style type="text/css">
.dragbox { position: absolute; border: red 2px ridge; background-color:transparent; z-index: 500; }
</style>

<script type="text/javascript" src="/incl/slider.js"></script>
<script type="text/javascript" src="/incl/tooltip.js"></script>

<script language="JavaScript">
<!--
try
{
  var langObjPTZIncl = new Language("incl_platoon_ptz", "ptz_incl");
  langObjPTZIncl.init(false, true);
}
catch(e)
{
  delete e;
function Language_backwardcomp()
{
  this.init = function(whatever)
  {
    window.focus();
  }

  this.getText = function(id)
  {
    var arr = new Array();
    arr["ptzInclPanToDegTxt"] = "Pan to [#]";
    arr["ptzInclXZoomTxt"] = "[#]x zoom";
    arr["ptzInclXDZoomTxt"] = "[#]x D zoom";
    arr["ptzInclXODZoomTxt"] = "[#]x ([#D]x D) zoom";
    arr["ptzInclZoomOutTxt"] = "Zoom out";
    arr["ptzInclZoomInTxt"] = "Zoom in";
    arr["ptzInclFocNeTxt"] = "Focus near [#]%";
    arr["ptzInclFocFaTxt"] = "Focus far [#]%";
    arr["ptzInclsetFocToTxt"] = "Set focus to [#]%";
    arr["ptzInclClIrisTxt"] = "Close iris [#]%";
    arr["ptzInclOpIrisTxt"] = "Open iris [#]%";
    arr["ptzInclSetIrisTxt"] = "Set iris to [#]%";
    arr["ptzInclTiDownDegTxt"] = "Tilt down [#]";
    arr["ptzInclTiUpDegTxt"] = "Tilt up [#]";
    arr["ptzInclTiDownToDegTxt"] = "Tilt down to [#]";
    arr["ptzInclTiUpToDegTxt"] = "Tilt up to [#]";

	  if( arr[id] != null )
	    return arr[id];
	  return "";
  }
}
  var langObjPTZIncl = new Language_backwardcomp();
}

var undefinedVar;  //Workaround for IE5
var img = undefinedVar;  // The video stream image object
var cross = undefinedVar;  // The crosshair image object
var siPos;
var thedragbox;
var thedragarea;
if (browser != "IE")
  var boxdef = new Box(0,0,10,10);
var radius;
var mode = "center";

var imagerotation = "";
    imagerotation = "0"; //root_Image_I#_Appearance_Rotation
  var imagemirror = "";
  if (imagemirror == "")
    imagemirror = "no";

var ptzDefMaxWindow = [1280,960];
var ptzDefMinWindow = [160,120];
var ptzDefMaxZoomList = [
  [1, 1],
  [5000, 2],
  [9999, 3.000000],
];

  var position_interval = ((typeof(ptzDefQueryInterval) != "number" || isNaN(ptzDefQueryInterval)) ? 1000 : ptzDefQueryInterval);

function noAction(event)
{
  return true;
}

function init()
{
  if ((browser != "IE") && (("/mjpg/video.mjpg".indexOf("/mjpg/") != -1) || (document.URL.indexOf("/view/view.shtml") == -1))) {
    img = document.getElementById("stream");
    cross = document.getElementById("crosshair");
    switchMode();
    // Center crosshair
    var si = document.getElementById("stream");
    var ch = document.getElementById("crosshair");
    siPos = getPos(si);
    ch.style.left = (si.width - ch.width)/2 + siPos.x;
    ch.style.top = (si.height - ch.height)/2 + siPos.y;
    thedragbox = document.getElementById("zoombox");

    if(thedragbox != null)
      thedragbox.style.visibility = 'hidden';
    if (mode == "center") {
      thedragarea = document.getElementById("stream");
      thedragarea.onmousedown = placeHandler;
      thedragarea.onmouseup = noAction;
      thedragarea.onmousemove = noAction;
        cross.onmousedown = placeHandler;
    }
  }
}

if (browser !== "IE" && mode === "center" && typeof AXIS !== "undefined" && typeof AXIS.CustomEventUtil !== "undefined") {
  (function() {
    function disableDragging() {
      thedragarea.onmousedown = noAction;
      thedragarea.onmouseup = noAction;
      thedragarea.onmousemove = noAction;
        cross.onmousedown = noAction;
    }

    function enableDragging() {
      thedragarea.onmousedown = placeHandler;
      thedragarea.onmouseup = noAction;
      thedragarea.onmousemove = noAction;
        cross.onmousedown = placeHandler;
    }

    AXIS.CustomEventUtil.subscribe("areaZoom:disable", disableDragging);
    AXIS.CustomEventUtil.subscribe("areaZoom:enable", enableDragging);
  })();
}

function switchMode()
{
  var ptzmode;
  if (!img)
    return;
  img.onmousedown = undefinedVar;
  img.onmouseup   = undefinedVar;
  img.onmousemove = undefinedVar;
  img.style.cursor = "crosshair";
    cross.onmousedown = undefinedVar;
    cross.onmouseup   = undefinedVar;
    cross.onmousemove = undefinedVar;
    cross.style.cursor = "crosshair";
      if (mode == "joystick") {
        cross.style.visibility = '';
      }
      else {
        cross.style.visibility = 'hidden';
      }

  if (mode == "center") {
    ptzmode = "center";
  } else if (mode == "joystick") {
    ptzmode = "joystick";
    img.onmousedown = ptzJoystick_start;
      cross.onmousedown = ptzJoystick_start;
  } else {
    ptzmode = "off";
  }
}

var ptzCommand_stop = false;

function ptzJoystick_start(event)
{
  return;
  img.onmousemove = ptzJoystick;
  img.onmouseup = ptzStop;
  img.onmouseout  = ptzStop;
  window.onblur   = ptzStop;
    cross.onmousemove = ptzJoystick;
    cross.onmouseup = ptzStop;
  document.onmouseup = ptzStop;

  ptzCommand_stop = false;
  ptzJoystick(event);

  return false;
}

function ptzJoystick(event)
{
  var mousePos = getMousePosition(event);
  var imgPos = getPos(img);
  mousePos.x -= imgPos.x;
  mousePos.y -= imgPos.y;
  var pspeed = 100 * (mousePos.x*2 - imgPos.w) / imgPos.w;
  var tspeed = -100 * (mousePos.y*2 - imgPos.h) / imgPos.h;
  var cmd = "continuouspantiltmove="+Math.floor(pspeed)+","+Math.floor(tspeed);
  ptzCommand(cmd);
  return false; // Returning false prevents image drag'n'drop behaviour in mozilla.
}

function ptzStop(event)
{
  if (event.relatedTarget && event.relatedTarget === document.getElementById('crosshair')) {
    return;
  }
  img.onmouseup   = undefinedVar;
  img.onmousemove = undefinedVar;
  img.onmouseout  = undefinedVar;

    cross.onmouseup   = undefinedVar;
    cross.onmousemove = undefinedVar;
  document.onmouseup = undefinedVar;

  var cmd = "continuouspantiltmove=0,0";

  ptzCommand_stop = true;
  ptzCommand(cmd, true);
  return false;
}

var ptzRequest = AxisConnectionFactory.createAjaxConnection();
ptzRequest.setOverrideMimeType( 'text/plain' );

var theCameraNumber = "";

var ptzCommand_queue = false;
function ptzCommand(cmdstring, que)
{
  if (ptzRequest.getReadyState() > 0 && ptzRequest.getReadyState() < 4) {
    if (que) {
      ptzCommand_queue = cmdstring;
    }
    return false;
  }


  if (theCameraNumber == "") theCameraNumber = "1";

  var now = new Date();
  var ptzUrl = "/axis-cgi/com/ptz.cgi?camera="+theCameraNumber+"&";
  ptzUrl += cmdstring;
  if (imagerotation != "")
    ptzUrl += "&imagerotation=" + imagerotation;
  if (imagemirror != "")
    ptzUrl += "&mirror=" + imagemirror;
  ptzUrl += "&timestamp=" + now.getTime();

  AxisConnectionFactory.sendAsync(["GET", ptzUrl], null, ptzCommand_onreadystatechange, ptzRequest);
}

function ptzCommand_onreadystatechange()
{
  try
  {
    if(ptzRequest.getStatus() == 401)
    {
      return;
    }
  }
  catch( e )
  {
  }

  if (typeof(ptzRequest) == 'object' && ptzRequest.getReadyState() == 4) {
    var responseText = ptzRequest.getResponseText();
    if (!ptzCommand_stop && responseText.length > 0) {
      var alertTxt;
      if (responseText.indexOf("Control is not possessed - request put in control queue.") >= 0) {
        alertTxt = langObjPTZIncl.getText("ptzInclContrlPossessTxt");
      } else {
        alertTxt = responseText.replace(/<.*>/ig, "").trim();
      }
      var panEnabled = true;
      var tiltEnabled = true;
      if (!((alertTxt.indexOf('pan') != -1 && !panEnabled) || (alertTxt.indexOf('tilt') != -1 && !tiltEnabled)))
        alert(alertTxt);
    }

    if (ptzCommand_queue) {
      var cmdstring = ptzCommand_queue;
      ptzCommand_queue = false;
      ptzCommand(cmdstring);
    }

    if (typeof AXIS !== "undefined" && typeof AXIS.CustomEventUtil !== "undefined") {
      AXIS.CustomEventUtil.publish("PTZ:viewChanged");
    }
  }
}

function selectVideoOrPtz(selection)
{
  if (selection == "video") {
    document.getElementById("videoselection").className = "selectedTab";
    if (document.getElementById("ptzselection"))
      document.getElementById("ptzselection").className = "unselectedTab";
    document.getElementById("videoItems").className = "shownItems";
    document.getElementById("ptzItems").className = "collapsed";
  } else {
    document.getElementById("videoselection").className = "unselectedTab";
    if (document.getElementById("ptzselection"))
      document.getElementById("ptzselection").className = "selectedTab";
    document.getElementById("videoItems").className = "collapsed";
    document.getElementById("ptzItems").className = "shownItems";
  }
}

function setPtzMode()
{
  if (document.getElementById("ptzModeSelector").selectedIndex == 1) {
    imgNavigation(false);
  } else if (document.getElementById("ptzModeSelector").selectedIndex == 2) {
    centermodeNavigation(true);
  } else {
    imgNavigation(true);
  }
}

function placeHandler(event)
{
  if (!event) event = window.event;
  var mpos = getMousePosition(event);

  thedragbox.onmousemove = dragHandler;
  thedragbox.onmouseup = stopDragging;
  thedragarea.onmousemove = dragHandler;
  thedragarea.onmouseup = stopDragging;
    cross.onmouseup = stopDragging;

  thedragbox.style.width = boxdef.w;
  thedragbox.style.height = boxdef.h;
  thedragbox.style.left = mpos.x;
  thedragbox.style.top = mpos.y;

  boxdef.x = mpos.x;
  boxdef.y = mpos.y;
  event.cancelBubble = true;
  if (event.stopPropagation) event.stopPropagation();
  return false; // Returning false prevents image drag'n'drop behaviour in mozilla.
}

function stopDragging(event)
{
  if (!event) event = window.event;
  thedragbox.onmousemove = noAction;
  thedragbox.onmouseup = noAction;
  thedragarea.onmouseup = noAction;
  thedragarea.onmousemove = noAction;
  thedragbox.style.visibility = 'hidden';
  thedragbox.style.cursor = 'crosshair';
  thedragarea.style.cursor = 'crosshair';
  event.cancelBubble = true;
  if (event.stopPropagation) event.stopPropagation();

  var si = document.getElementById("stream");
  var siPos = getPos(si);
  var boxCenterX = parseInt(thedragbox.style.left.slice(0, -2) - siPos.x + thedragbox.style.width.slice(0, -2)/2, 10);
  var boxCenterY = parseInt(thedragbox.style.top.slice(0, -2) - siPos.y + thedragbox.style.height.slice(0, -2)/2, 10);
  var imgPos = getPos(img);
  if (thedragbox.style.width.slice(0, -2) < 11) {
    var mousePos = getMousePosition(event);
    var speed = parseInt("100", 10);
    mousePos.x -= imgPos.x;
    mousePos.y -= imgPos.y;

    var cmd = "";

        cmd += "speed="+speed+"&";

    cmd += "center="+mousePos.x+","+mousePos.y+"&imagewidth="+imgPos.w+"&imageheight="+imgPos.h;;

  } else {
    var zoomfactor = parseInt(50*(Math.sqrt(imgPos.w*imgPos.w + imgPos.h*imgPos.h)/radius), 10);
    var cmd = "areazoom=" + boxCenterX + "," + boxCenterY + "," + zoomfactor + "&imagewidth=" + imgPos.w + "&imageheight=" + imgPos.h;
  }
  ptzCommand(cmd);
  return false;
}

function dragHandler(event)
{
  if (!event) event = window.event;
  var mpos = getMousePosition(event);
  resizeBox(mpos.x, mpos.y);
  event.cancelBubble = true;
  if (event.stopPropagation) event.stopPropagation();
  return false; // Returning false prevents event bubbling
}

function resizeBox(mouseX, mouseY)
{
  var nX;
  var nY;
  var nW;
  var nH;

// Calculate radius
  var katX = Math.abs(boxdef.x - mouseX)
  var katY = Math.abs(boxdef.y - mouseY)
  radius = Math.sqrt(katX*katX + katY*katY)
    nX = boxdef.x - radius*Math.sin(Math.atan(1024/768));
    nY = boxdef.y - radius*Math.cos(Math.atan(1024/768));

  nW = 2*(boxdef.x - nX)
  nH = 2*(boxdef.y - nY)

  thedragbox.style.left = nX;
  thedragbox.style.top = nY;
  thedragbox.style.width = nW;
  thedragbox.style.height = nH;
  thedragbox.style.visibility = '';
}

function requestPTZPresets(responseFunction) {
  var nbrOfSources,
      group = [];

     nbrOfSources = 1;

  for (var n = 0; n < nbrOfSources; n++) {
    group.push("root.PTZ.Preset.P"+n+".Position");
  }

  getParamsAsUTF8(group, responseFunction, "&usergroup=anonymous");
}


/* =================================== PTZ slider functions =================================== */

  var maxPan = parseInt("180", 10);
  var minPan = parseInt("-180", 10);
  var panPos   = Math.round((minPan+maxPan)/2);
  var maxTilt = parseInt("180", 10);
  var minTilt = parseInt("-180", 10);
  var tiltPos  = Math.round((minTilt+maxTilt)/2);

var panSlider   = null;
var tiltSlider  = null;
var zoomSlider  = null;
var focusSlider = null;
var irisSlider = null;

var brightnessSlider  = null;

var theNewSliderValue;

var ptzPosInterval = null;
var initiateToolTip = true;

var ptzValues = AxisConnectionFactory.createAjaxConnection();
ptzValues.setOverrideMimeType( 'text/plain' );

var isCtlStarted = false;

var checkPosition = true;
function getPtzPositions()
{
  if (!checkPosition) return;

  if (ptzValues.getReadyState() > 0 && ptzValues.getReadyState() < 4)
    return;

  var now = new Date();
  var timestamp = now.getTime();
  if (theCameraNumber == "") theCameraNumber = "1";
    var url = "/axis-cgi/com/ptz.cgi?query=position,limits&camera="+theCameraNumber+"&html=no";
      if (imagerotation != "")
        url += "&imagerotation=" + imagerotation;
      if (imagemirror != "")
        url += "&mirror=" + imagemirror;
    url += "&timestamp=" + timestamp;
  AxisConnectionFactory.sendAsync(["GET", url], "", showPtzValues, ptzValues);
}

var thePtzValuesArray;
function showPtzValues()
{
  if (ptzPosInterval)
    window.clearTimeout(ptzPosInterval);

  try {
    if (ptzValues.getStatus() == 401) {
      return;
    }
  }
  catch( e ) {}

  if (typeof(ptzValues) == 'object' && ptzValues.getReadyState() == 4) {

      if (typeof (ctlStart) == "function" && !isCtlStarted) {
        isCtlStarted = true;
        ctlStart();
      }

    if (ptzValues.getStatus() == 200) {

      if (typeof AXIS !== "undefined" && typeof AXIS.CustomEventUtil !== "undefined") {
        AXIS.CustomEventUtil.publish("PTZ:viewChanged");
      }
      var thePtzValuesString = escape(ptzValues.getResponseText());
      thePtzValuesString = thePtzValuesString.replace(/%3D/g,'=');
      thePtzValuesString = thePtzValuesString.replace(/%0D/g,'');
      thePtzValuesString = thePtzValuesString.replace(/%0A/g,',');
      thePtzValuesArray  = thePtzValuesString.split(",");

      var panValExists   = false;
      var tiltValExists  = false;
      var zoomValExists  = false;
      var focusValExists = false;
      var irisValExists  = false;
      var brightnessValExists  = false;

      var p, j, v;
      var arrElType;
      var len = (typeof( thePtzValuesArray ) != "undefined") ? thePtzValuesArray.length : 0;
      var displayAutoIris;

      for (i = 0; i < len; i++)
      {
        arrElType = typeof( thePtzValuesArray[i] );
        if(arrElType.toLowerCase() != "string" )
          continue;
        j = thePtzValuesArray[i].indexOf("=");
        if (j < 0) continue;
        v = thePtzValuesArray[i].substr(j+1);
        p = parseInt(v, 10);
        switch (thePtzValuesArray[i].substr(0, j)) {
          case "pan":
            panPos = p;
            if (!isNaN(panPos))
              panValExists = true;
            break;
          case "tilt":
            tiltPos = p;
            if (!isNaN(tiltPos))
              tiltValExists = true;
            break;
          case "zoom":
            zoomPos = p;
            if (!isNaN(zoomPos))
              zoomValExists = true;
            break;
          case "MinPan":
              minPan = p;
            break;
          case "MaxPan":
              maxPan = p;
            break;
          case "MinTilt":
              minTilt = p;
            break;
          case "MaxTilt":
              maxTilt = p;
            break;
          case "MinBrightness":
            minBrightness = p;
            break;
          case "MaxBrightness":
            maxBrightness = p;
            break;
          case "brightness":
            brightnessPos = p;
            brightnessValExists = !isNaN(brightnessPos);
            break;
          default:
            break;
        }
      }
    }

    window.clearTimeout(ptzPosInterval);
    if (panValExists || tiltValExists || zoomValExists || focusValExists || irisValExists || brightnessValExists)
      ptzPosInterval = window.setTimeout(getPtzPositions, position_interval);

    if (initiateToolTip) {

      createToolTip("toolTip", 0, 300, TOOLTIP_STYLE2, 15, 15, TOOLTIP_FOLLOWMOUSE);

      initiateToolTip = false;
    }
  }
}

var newPtzVal = AxisConnectionFactory.createAjaxConnection();
newPtzVal.setOverrideMimeType( 'text/plain' );
function ptz_slider_onChange(group)
{
  if ((group == "pan" && "no" == "rel") ||
      (group == "tilt" && "no" == "rel") ||
      (group == "zoom" && "" == "rel") ||
      (group == "focus" && "no" == "rel") ||
      (group == "brightness" && "" == "rel") ||
      (group == "iris" && "no" == "rel")) {
    group = "r" + group;
  }
  if (theCameraNumber == "") theCameraNumber = "1";
  var url = "/axis-cgi/com/ptz.cgi?camera="+theCameraNumber+"&"+group+"="+parseFloat(Math.round(theNewSliderValue * 10)/10);
  if (imagerotation != "")
    url += "&imagerotation=" + imagerotation;
  if (imagemirror != "")
    url += "&mirror=" + imagemirror;

  if (newPtzVal.getReadyState() > 0 || newPtzVal.getReadyState() < 4)
    newPtzVal.abort();

  AxisConnectionFactory.sendAsync(["GET", url], "", newPtzVal_onchange, newPtzVal);
}

function newPtzVal_onchange()
{
  if (!checkPosition) return;

  if (ptzPosInterval)
    window.clearTimeout(ptzPosInterval);

  try {
    if(newPtzVal.getStatus() == 401) {
      return;
    }
  }
  catch(e) {}

  if (typeof(newPtzVal) == 'object' && newPtzVal.getReadyState() == 4) {
    var responseText = newPtzVal.getResponseText();
    if (responseText.length > 0) {
      if (responseText.indexOf("Control is not possessed - request put in control queue.") >= 0) {
        alert(langObjPTZIncl.getText("ptzInclContrlPossessTxt"));
      } else {
        alert(responseText.replace(/<.*>/ig, "").trim() );
      }
    }

    ptzPosInterval = window.setTimeout(getPtzPositions, position_interval);
  }
}

/* =================================== Continuous move (arrows) =================================== */

var newContMove = AxisConnectionFactory.createAjaxConnection();
newContMove.setOverrideMimeType( 'text/plain' );

var mouseUp;

function continousMove(action, val)
{

  if (newContMove.getReadyState() > 0 && newContMove.getReadyState() < 4)
    newContMove.abort();

  mouseUp = (val == "0,0" || val == "0");
  var theAction = "continuous";
  if (action == "pan" || action == "tilt") theAction += "pantiltmove=";
  else if (action == "zoom") theAction += "zoommove=";
  else if (action == "focus") theAction += "focusmove=";
  else if (action == "iris") theAction += "irismove=";
  else if (action == "brightness") theAction += "brightnessmove=";

  theAction += val;

  if (imagerotation != "")
    theAction += "&imagerotation=" + imagerotation;
  if (imagemirror != "")
    theAction += "&mirror=" + imagemirror;

  var now = new Date();
  if (theCameraNumber == "") theCameraNumber = "1";
  AxisConnectionFactory.sendAsync(["GET", "/axis-cgi/com/ptz.cgi?camera="+theCameraNumber+"&"+theAction + "&timestamp=" + now.getTime()], "", function()  {newContMove_onchange(theAction) }, newContMove);
  delete now;
}

function newContMove_onchange(theAction)
{

  try {
    if(newContMove.getStatus() == 401) {
      return;
    }
  }
  catch(e) {}

  if (typeof(newContMove) == 'object' && newContMove.getReadyState() == 4) {
    if (!!mouseUp) {
      var now = new Date();
      if (theCameraNumber == "") theCameraNumber = "1";
      AxisConnectionFactory.sendSync(["GET", "/axis-cgi/com/ptz.cgi?camera="+theCameraNumber+"&"+theAction+"=0,0&timestamp=" + now.getTime()], null);
      delete now;
    }
    if( ptzPosInterval )
      window.clearTimeout(ptzPosInterval);

    var responseText = newContMove.getResponseText();
    if (responseText.length > 0) {
      if (!mouseUp) {
        // Don't show the pop-up on the mouse up event.
        var alertTxt = responseText.replace(/<.*>/ig, "").trim();
        var panEnabled = true;
        var tiltEnabled = true;
        if (!((alertTxt.indexOf('pan') != -1 && !panEnabled) || (alertTxt.indexOf('tilt') != -1 && !tiltEnabled))) {
          if (alertTxt.indexOf("Control is not possessed - request put in control queue.") >= 0) {
            alert(langObjPTZIncl.getText("ptzInclContrlPossessTxt"));
          } else {
            alert(alertTxt);
          }
        }
      }
    }
    ptzPosInterval = window.setTimeout(getPtzPositions, position_interval);
  }
}

/* =================================== Generic object and event functions =================================== */

function getObjX(obj)
{
  var pos = 0;
  if (obj.offsetParent) {
    while(obj.offsetParent) {
      pos += obj.offsetLeft;
      obj = obj.offsetParent;
    }
  } else if (obj.x) {
    pos = obj.x;
  }
  return pos;
}

function getObjY(obj)
{
  var pos = 0;
  if (obj.offsetParent) {
    while(obj.offsetParent) {
      pos += obj.offsetTop;
      obj = obj.offsetParent;
    }
  } else if (obj.y) {
    pos = obj.y;
  }
  return pos;
}

function getEventX(e)
{
  if (e.pageX) {
    return e.pageX;
  } else if (e.clientX) {
    return (e.clientX + document.body.scrollLeft);
  }
}

function getEventY(e)
{
  if (e.pageY) {
    return e.pageY;
  } else if (e.clientY) {
    return (e.clientY + document.body.scrollTop);
  }
}


/* =================================== PTZ bar and tooltip handling =================================== */

// Array to hold all bars
var bars = new Array();

// Bar data object:
// element_id   : ID of bar container element. Offsets and values are calculated from this element's geometry.
// api_cmd      : PTZ API command to send as action when bar is clicked.
// value_prec   : precision of value to send (number of decimals).
// linear:      : if != 1, the scale of the bar is not linear. Try 3 for non-linear behaviour.
// orientation  : Bar.ORIENT_H for horizontal bar,  Bar.ORIENT_V for vertical bar.
// mode         : Bar.MODE_A for absolute bar, Bar.MODE_R for relative bar.
// tooltip_func : Function taking a bar object as argument and returns a string to set as tooltip,
//                or set undefined to disable tooltip.
// range_start  : Pixel offset at which the bar scale starts.
// range_end    : Pixel offset at which the bar scale ends.
// min_val      : value of scale at range_start.
// max_val      : value of scale at range_end.

Bar.ORIENT_H = 1;
Bar.ORIENT_V = 2;
Bar.MODE_A = 3;
Bar.MODE_R = 4;

function Bar(element_id, api_cmd, value_prec, linear, orientation, mode, tooltip_func, range_start, range_end, min_val, max_val)
{
  this.element_id = element_id;
  this.api_cmd = api_cmd;
  this.value_prec = value_prec;
  this.linear=linear;
  this.orientation = (orientation == Bar.ORIENT_V) ? Bar.ORIENT_V : Bar.ORIENT_H;
  this.mode = (mode == Bar.MODE_A) ? Bar.MODE_A : Bar.MODE_R;
  this.tooltip_func = tooltip_func;
  this.range_start = range_start;
  this.range_end = range_end;
  this.min_val = min_val;
  this.max_val = max_val;
  this.value = undefined;
  this.timer = undefined;
  this.lastvalue = undefined;
}

// Get bar value at event mouse position
function getBarValue(event, target, bar)
{
  var bar_pos = (bar.orientation == Bar.ORIENT_H) ? getObjX(target) : getObjY(target);
  var click_pos = (bar.orientation == Bar.ORIENT_H) ? getEventX(event) : getEventY(event);
  var offset = click_pos-bar_pos - bar.range_start;
  var span = bar.range_end - bar.range_start;
  var pos; // 0 ... 1
  var val; // bar.min_val ... bar.max_val
  if (bar.orientation == Bar.ORIENT_H) {
    if (offset < 0) {
      val = bar.min_val;
      pos = 0;
    } else if (offset > span) {
      val = bar.max_val;
      pos = 1;
    } else {
      pos = offset/span;
    }
  } else {
    if (offset < 0) {
      val = bar.max_val;
    } else if (offset > span) {
      val = bar.min_val;
    }
    pos = (span - offset)/span;
  }
  if (val == undefined) {
    if (bar.linear != 1) {
      if (bar.mode == Bar.MODE_A) {
        // Non-linear absolute
        pos = Math.pow(pos,bar.linear)/Math.pow(1,bar.linear);
        val = bar.min_val + pos * (bar.max_val - bar.min_val);
      } else {
        // Non-linear relative
        val = 2*(pos-0.5); // +/- 1.0
        val = Math.abs(Math.pow(val,bar.linear)/Math.pow(1,bar.linear));
        if (pos < 0.5)
          val = bar.min_val * (val);
        else
          val = bar.max_val * (val);
      }
    } else {
      if (bar.mode == Bar.MODE_A) {
       // Linear absolute
        val = bar.min_val + pos * (bar.max_val - bar.min_val);
      } else {
        // Linear relative
        if (pos < 0.5)
          val = bar.min_val * ((0.5-pos) * 2);
        else
          val = bar.max_val * ((pos-0.5) * 2);
      }
    }
  }
  theNewSliderValue = val;
  return {
    val: val,
    pos: pos
  };
}

// Update a tooltip, if bar value have changed (mouse have moved)
function updateBarTooltip(bar)
{
  if (bar.value == bar.lastvalue) {
    // Mouse have stopped, disable tooltip updates.
    window.clearInterval(bar.timer);
    bar.timer = undefined;
    bar.lastvalue = undefined;
  } else {
    var status = bar.tooltip_func(bar);
    if (bar.lastvalue == undefined)
      setToolTip("toolTip", bar.element_id, status);
    else
      updateToolTip("toolTip", bar.element_id, status);
    bar.lastvalue = bar.value;
  }
}

// Disable tooltip updates
function handleBarExit(target, event)
{
  if (!event) event = window.event;
  for (var b = 0 ; b < bars.length ; b++) {
    if (bars[b].element_id == target.id) {
      if (bars[b].timer != undefined) {
        window.clearInterval(bars[b].timer);
        bars[b].timer = undefined;
      }
    }
  }
}

// Get bar value at mouse position and update tooltip
function handleBarMove(target, event)
{
  if (!event) event = window.event;
  for (var b = 0 ; b < bars.length ; b++) {
    if (bars[b].element_id == target.id && bars[b].tooltip_func) {
      var barsBarValue = getBarValue(event, target, bars[b]);

      bars[b].value = barsBarValue.val;
      bars[b].positionV = barsBarValue.pos;
      if (bars[b].timer == undefined) {
        // Don't update tooltip at each mousemove event, it will cause ugly delays and use too much cpu.
        // Instead, start a timer to update at 10Hz until mouse stoppes moving.
        updateBarTooltip(bars[b]);
        var code = "updateBarTooltip(bars[" + b +"]);";
        bars[b].timer = window.setInterval(code, 100)
      }
      return;
    }
  }
}


/* =================================== PTZ tooltip formatting =================================== */
// These functions can be replaced to suit different products and driver types

function panToolTip(bar)
{
  var str = langObjPTZIncl.getText("ptzInclPanToDegTxt");
  return str.replace(/\[#\]/, Number(bar.value).toFixed(1));
}

function zoomToolTip(bar)
{
  if (bar.value < zoomPos)
    return langObjPTZIncl.getText("ptzInclZoomOutTxt");
  else
    return langObjPTZIncl.getText("ptzInclZoomInTxt");
}

function focusToolTip(bar)
{
    var str_s = langObjPTZIncl.getText("ptzInclsetFocToTxt");
    var focus = 100 * bar.positionV;
    return str_s.replace(/\[#\]/, Number(focus).toFixed(1));
}

function irisToolTip(bar)
{
    var str_s = langObjPTZIncl.getText("ptzInclSetIrisTxt");
    var iris = 100 * (bar.value/bar.max_val);
    return str_s.replace(/\[#\]/, Number(iris).toFixed(1));
}

function brightnessToolTip(bar)
{
    var str_s = langObjPTZIncl.getText("ptzInclSetBrightnessTxt");
    var brightness = 100 * (bar.value/bar.max_val);
    return str_s.replace(/\[#\]/, Number(brightness).toFixed(1));
}

function tiltToolTip(bar)
{
    var str_d = langObjPTZIncl.getText("ptzInclTiDownToDegTxt");
    var str_u = langObjPTZIncl.getText("ptzInclTiUpToDegTxt");
  if (bar.value < tiltPos) {
    return str_d.replace(/\[#\]/, Number(bar.value).toFixed(1));
  } else {
    return str_u.replace(/\[#\]/, Number(bar.value).toFixed(1));
  }
}

//-->
</script>
      </td>
      <td width="4"><img src="/pics/blank.gif" width="4" height="1" border="0" alt=""></td>
      <td width="1" class="lineBg"><img src="/pics/blank.gif" width="1" height="1" border="0" alt=""></td>
    </tr>
    <!-- ################################################################ -->
    <!-- Defines the table width -->
    <tr>
      <td colspan="1" width="1" class="lineBg"><img src="/pics/blank.gif" width="1" height="1" alt=""></td>
      <td colspan="1" width="4"><img src="/pics/blank.gif" width="1" height="1" alt=""></td>
      <td colspan="1" width="768"><img src="/pics/blank.gif" width="1" height="1" alt=""></td>
      <td colspan="1" width="4"><img src="/pics/blank.gif" width="1" height="1" alt=""></td>
      <td colspan="1" width="1" class="lineBg"><img src="/pics/blank.gif" width="1" height="1" alt=""></td>
    </tr>
    <!-- ################################################################ -->
    <tr class="bottom-mainborder">
      <td colspan="2"><img src="/pics/line_corner_lb_5x5px.gif" width="5" height="5" alt=""></td>
      <td colspan="1" background="/pics/line_b_100x5px.gif"><img src="/pics/blank.gif" width="1" height="1" alt=""></td>
      <td colspan="2"><img src="/pics/line_corner_rb_5x5px.gif" width="5" height="5" alt=""></td>
    </tr>


    <tr>
      <td width="1"><img src="/pics/blank.gif" width="1" height="1" border="0" alt=""></td>
      <td colspan="6" valign="middle" align="left">
        <table cellpadding="0" cellspacing="5" border="0">
          <tbody><tr>
              <td>&nbsp;</td>
          </tr>
        </tbody></table>
      </td>
      <td width="1"><img src="/pics/blank.gif" width="1" height="1" border="0" alt=""></td>
    </tr>
  </tbody></table>
</form></td></tr>

 <!-- wizardForm -->
</tbody></table>


</body></html>
